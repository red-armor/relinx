"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),o=e(require("invariant"));const n=()=>{},s={computation:null,dispatch:n,attachStoreName:n,useProxy:!0,namespace:null,patcher:null,trackerNode:null,useRelinkMode:!0,application:null};var i=t.createContext(s,()=>0);function c(...e){console.log("**DEBUG**",...e)}class a{constructor(e,t){this.prop=e||"root",this.parent=t,this.children={},this.patchers=[]}addPathNode(e,t){const r=e.length;e.reduce((e,o,n)=>{if(e.children[o]||(e.children[o]=new a(o,e)),n===r-1){const r=e.children[o];r.patchers.push(t),t.addRemover(()=>{const e=r.patchers.indexOf(t);-1!==e&&r.patchers.splice(e,1)})}return e.children[o]},this)}destroyPathNode(){try{this.patchers.forEach(e=>e.destroyPatcher()),this.children&&Object.keys(this.children).forEach(e=>{this.children[e].destroyPathNode()}),this.parent&&delete this.parent.children[this.prop]}catch(e){c("[PathNode destroy issue]",e)}}}const h=Function.call.bind(Object.prototype.toString),p=e=>"[object Object]"===h(e),l=(e,t)=>h(e)===h(t);class u{constructor({base:e,namespace:t,strictMode:r}){this.base=e,this.node=new a,this.pendingPatchers=[],this.namespace=t,this.strictMode=r}update(e){this.pendingPatchers=[];try{e.forEach(e=>this.treeShake(e)),e.forEach(e=>this.updateBase(e))}catch(e){c("[Application] update issue ",e)}const t=[],r=this.pendingPatchers.length;for(let e=0;e<r;e++){const r=this.pendingPatchers[e].patcher,o=t.length;let n=!1;for(let e=0;e<o;e++){const o=t[e];if(r.belongs(o)){n=!0;break}if(o.belongs(r)){t.splice(e,1),t.splice(e,0,r),n=!0;break}}n||t.push(r)}this.pendingPatchers.length&&this.pendingPatchers.forEach(({patcher:e})=>{e.triggerAutoRun()})}updateBase({storeKey:e,changedValue:t}){this.base[e]={...this.base[e],...t}}treeShake({storeKey:e,changedValue:t}){const r=this.node.children[e],o=this.base[e],n=o,s={...o,...t};if(!r)return;const i=[],c=(e,t,r,o,s)=>{if((a=t)===(u=r)?0!==a||1/a==1/u:a!=a&&u!=u)return;var a,u,d;l(t,r)&&(p(d=r)||(e=>"[object Array]"===h(e))(d))||e.patchers.length&&(e.patchers.forEach(e=>{this.pendingPatchers.push({collections:o,patcher:e,operation:s})}),e.patchers.forEach(e=>e.markDirty()));const f=Object.keys(e.children);let y=f,P=[];const g=[];if(l(t,r)&&Array.isArray(r)){const e=r.length;e<t.length&&(y=f.filter(t=>parseInt(t,10)<e||"length"===t),P=f.filter(t=>parseInt(t,10)>=e&&(g.push({path:o.concat(t),isDelete:!0}),!0)))}if(p(r)&&p(t)){const o=Object.keys(r),n=function(e=[],t){const r=[];for(let o=0;o<e.length;o++){const n=e[o];-1===t.indexOf(n)&&r.push(n)}return r}(Object.keys(t),o);n.length&&i.push(((e,t)=>{t.forEach(t=>{const r=e.children[t];r&&r.destroyPathNode()})}).bind(null,e,n))}this.strictMode&&y.forEach(r=>{t&&void 0!==t[r]||e.children[r].patchers.forEach(e=>{const t=e.displayName,s=o.concat(r).join(".");console.warn("root base value ",n),console.warn(`Maybe you are using an un-declared props %c${s}`+` %cin Component %c${t} %cYou'd better declare this prop in model first,`+"or component may not re-render when value changes on ES5.","color: #ff4d4f; font-weight: bold","","color: #7cb305; font-weight: bold","")})}),y.forEach(n=>{c(e.children[n],t?t[n]:void 0,r?r[n]:void 0,o.concat(n),g)}),P.length&&i.push(((e,t)=>{t.forEach(t=>{const r=e.children[t];r&&r.destroyPathNode()})}).bind(null,e,P))};c(r,o,s,[e],[]),i.forEach(e=>e())}addPatcher(e){e.paths.forEach(t=>{this.node.addPathNode(t,e)})}getStoreData(e){const t=this.base[e];return t||o(!1),t}}const d={},f=Math.pow(2,24),y={},P=({namespace:e,componentName:t})=>{y[e]||(y[e]={});const r=y[e][t]||0;return y[e][t]=r+1,`${e}_${t}_patcher_${r}`},g=(e,t=2)=>`00${e}`.slice(-t),k=e=>{const t=new Date(e),r=t.getHours(),o=t.getMinutes(),n=t.getSeconds(),s=t.getMilliseconds();return`${g(r)}:${g(o)}:${g(n)}.${g(s,3)}`},b=Function.apply.bind(console.log,null),v=console.groupEnd,x=Function.apply.bind(console.groupCollapsed,null),m=e=>{const{text:t,styles:r}=e.reduce((e,t)=>{const{text:r,styles:o}=e,[n,s]=t;return{text:`${r}%c ${n}`,styles:[].concat(o,s)}},{text:"",styles:[]});return[t,...r]},S=e=>{const{type:t,actions:r={},effects:o={},payload:n,actionType:s}=e,i=Object.keys(r),c=Object.keys(o);(e=>{const{type:t,payload:r="",actionType:o="action",style:n}=e,s=[];t&&(s.push([o,"color: #eb2f96; font-weight: bold"]),s.push([t,"color: #722ed1; font-weight: bold"])),"line"===n?b([...m(s),r]):x([...m(s),r])})(i.length||c.length?{type:t,payload:n,actionType:s}:{type:t,payload:n,actionType:s,style:"line"}),i.forEach(e=>{S(r[e])}),c.forEach(e=>{S(o[e])}),(i.length||c.length)&&v()},R=Function.call.bind(Object.prototype.toString),N=e=>"undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys(e):void 0!==Object.getOwnPropertySymbols?Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)):Object.getOwnPropertyNames(e),w=e=>!!e&&("object"==typeof e||"function"==typeof e),O="undefined"!=typeof Symbol?Symbol("tracker"):"__tracker__",j=e=>-1!==["[object Object]","[object Array]"].indexOf(R(e));function E(e){if(Array.isArray(e))return e.slice();const t=Object.create(Object.getPrototypeOf(e));return N(e).forEach(r=>{t[r]=e[r]}),t}const A=(e,t)=>{e.prototype=Object.create(t.prototype),e.prototype.constructor=e},F=(e,t,r)=>{Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})},C=(e,t)=>{Object.defineProperty(e,t,{enumerable:!1,configurable:!1})},$={trackerNode:null},D=e=>e.join("_"),M=e=>{const t=e.slice(),r={},o=[];for(let e=t.length-1;e>=0;e--){const n=t[e].slice(),s=n.length;let i=!1;for(let e=0;e<s;e++){const e=D(n),t=r[e]||0;if(i)r[e]=t+1,n.pop();else{if(t){r[e]=t-1;break}{const e=n.slice(),t=D(e);o.find(e=>D(e)===t)||o.push(e),i=!0,n.pop()}}}}return o};function T(){}const _=T.prototype;_.assertLink=function(e){const t=this.getProp("trackerNode");t||o(!1),$.trackerNode===t&&o(!1)},_.reportAccessPath=function(e){const t=this.getProp("paths"),r=this.getProp("parentProxy");t.push(e),r&&r.runFn("reportAccessPath",e)},_.cleanup=function(){this.setProp("paths",[]),this.setProp("propProperties",[])},_.unlink=function(){return this.getProp("base")},_.relink=function(e,t){try{this.runFn("assertLink","relink");const r=this;let o=e.slice(),n=o.pop();const s=e.length;let i=t;for(let t=0;t<s;t++){const r=e[t];if(void 0===i[r]){o=e.slice(0,t-1),n=e[t-1];break}i=i[r]}((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r,o).relinkProp(n,i)}catch(e){}},_.relinkProp=function(e,t){this.runFn("assertLink","relinkProp");const r=this.getProp("base"),o=this.getProp("childProxies"),n=this.getProp("accessPath");Array.isArray(r)&&this.setProp("base",r.filter(e=>e)),this.getProp("base")[e]=t,j(t)&&(o[e]=this.createChild(t,{accessPath:n.concat(e),parentProxy:this}))},_.relinkBase=function(e){this.runFn("assertLink","rebase"),this.runFn("rebase",e)},_.rebase=function(e){try{this.setProp("base",e)}catch(e){}},_.setRemarkable=function(){const e=this.getProp("accessPath"),t=this.getProp("parentProxy");return!!t&&(t.runFn("reportAccessPath",e),!0)},_.getRemarkableFullPaths=function(){const e=this.getProp("paths"),t=this.getProp("propProperties"),r=this.getProp("rootPath"),o=M(e).map(e=>r.concat(e)),n=t.map(e=>{const{path:t,source:r}=e;return(null==r?void 0:r.getProp("rootPath")).concat(t)}),s=M(n);return o.concat(s)},_.assertScope=function(){if(!this.getProp("useScope"))return;const e=this.getProp("trackerNode");if(e){if(!e.contains($.trackerNode)&&$.trackerNode)throw new Error(e.id+"is not child node of "+$.trackerNode.id+"Property only could be accessed by self node or parent node.")}else console.warn("trackerNode is undefined, which means you are using createTracker function directly.Maybe you should create TrackerNode object.")},C(_,"assertLink"),C(_,"reportAccessPath"),C(_,"cleanup"),C(_,"unlink"),C(_,"relink"),C(_,"relinkBase"),C(_,"relinkProp"),C(_,"setRemarkable"),C(_,"getRemarkableFullPaths"),C(_,"rebase"),C(_,"assertScope");let L=0;const B=function({accessPath:e,parentProxy:t,rootPath:r,base:o,trackerNode:n,useRevoke:s,useScope:i}){F(this,"id",`ES5Tracker_${L++}`),F(this,"trackerNode",n),F(this,"accessPath",e),F(this,"rootPath",r),F(this,"type",Array.isArray(o)?"array":"object"),F(this,"base",o),F(this,"parentProxy",t),F(this,"childProxies",{}),F(this,"isPeeking",!1),F(this,"propProperties",[]),F(this,"paths",[]),F(this,"useRevoke",s),F(this,"useScope",i),F(this,"isRevoked",!1),F(this,"assertRevoke",(function(){if(this.getProp("useRevoke")&&this.getProp("isRevoked"))throw new Error("Cannot use a proxy that has been revoked. Did you pass an object to an async process? ")}))};function K(e,t,r){const{accessPath:o=[],parentProxy:n,useRevoke:s,useScope:i,rootPath:c=[]}=t||{};if(!w(e))throw new TypeError("Cannot create proxy with a non-object as target or handler");const a=E(e);var h,p;if(h=e,p=t=>{const o=Object.getOwnPropertyDescriptor(e,t);!function(e,t,o){const n={enumerable:o,configurable:!1,get(){this.runFn("assertRevoke"),this.runFn("assertScope");const o=this.getProp("base"),n=this.getProp("accessPath"),a=this.getProp("childProxies"),h=this.getProp("isPeeking"),p=o[t],l=n.concat(`${t}`);if(!h){if($.trackerNode&&r.id!==$.trackerNode.id){const e=$.trackerNode.proxy,t=null==e?void 0:e.getProp("propProperties");if(t.push({path:l,source:r.proxy}),this.setProp("propProperties",t),r.proxy)return((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r.proxy,l)}this.runFn("reportAccessPath",l)}if(!j(p))return p;const u=a[t];return u&&u.base===p?u:a[t]=K(p,{accessPath:l,parentProxy:e,rootPath:c,useRevoke:s,useScope:i},r)}};Object.defineProperty(e,t,n)}(a,t,(null==o?void 0:o.enumerable)||!1)},Array.isArray(h)?h.forEach((e,t)=>p(t)):w(h)&&N(h).forEach(e=>p(e)),Array.isArray(e)){const e=Object.getPrototypeOf([]),t=Object.getOwnPropertyNames(e),o=(e,t,o=!0)=>function(){const n=Array.prototype.slice.call(arguments);if(this.runFn("assertRevoke"),o){const e=this.getProp("accessPath"),t=this.getProp("isPeeking"),o=e.concat("length");if(!t){if($.trackerNode&&r.id!==$.trackerNode.id){const e=$.trackerNode.proxy,t=null==e?void 0:e.getProp("propProperties");t.push({path:o,source:r.proxy}),this.setProp("propProperties",t)}this.runFn("reportAccessPath",o)}}return e.apply(t,n)};t.forEach(t=>{const r=e[t];if("function"==typeof r){const e=["concat","copyWith","fill","find","findIndex","lastIndexOf","pop","push","reverse","shift","unshift","slice","sort","splice","includes","indexOf","join","keys","entries","forEach","filter","flat","flatMap","map","every","some","reduce","reduceRight"];-1!==["concat","copyWith"].indexOf(t)?F(a,t,o(r,a,!1)):-1!==e.indexOf(t)&&F(a,t,o(r,a))}})}const l=new B({base:e,parentProxy:n,accessPath:o,rootPath:c,trackerNode:r,useRevoke:s,useScope:i});return F(a,"getProps",(function(){const e=Array.prototype.slice.call(arguments);return e.map(e=>this[O][e])})),F(a,"getProp",(function(){const e=Array.prototype.slice.call(arguments);return this[O][e[0]]})),F(a,"setProp",(function(){const e=Array.prototype.slice.call(arguments),t=e[0],r=e[1];return this[O][t]=r})),F(a,"runFn",(function(){const e=Array.prototype.slice.call(arguments),t=this[O][e[0]],r=e.slice(1);if("function"==typeof t)return t.apply(this,r)})),F(a,"unlink",(function(){return this.runFn("unlink")})),F(a,"createChild",(function(){const e=Array.prototype.slice.call(arguments),t=e[0]||{},o=e[1]||{};return K(t,{useRevoke:s,useScope:i,rootPath:c,...o},r)})),F(a,"revoke",(function(){this.getProp("useRevoke")&&this.setProp("isRevoked",!0)})),F(a,O,l),a}var U,I;A(B,T),(I=U||(U={})).Object="object",I.Array="array";let V=0;const W=function({accessPath:e,parentProxy:t,rootPath:r,base:o,trackerNode:n,useRevoke:s,useScope:i}){F(this,"id",`ProxyTracker_${V++}`),F(this,"trackerNode",n),F(this,"accessPath",e),F(this,"rootPath",r),F(this,"type",Array.isArray(o)?U.Array:U.Object),F(this,"base",o),F(this,"parentProxy",t),F(this,"childProxies",{}),F(this,"isPeeking",!1),F(this,"propProperties",[]),F(this,"paths",[]),F(this,"useRevoke",s),F(this,"useScope",i)};function q(e,t,r){const{accessPath:o=[],parentProxy:n,useRevoke:s,useScope:i,rootPath:c=[]}=t||{};if(!w(e))throw new TypeError("Cannot create proxy with a non-object as target or handler");const a=E(e),h=[O,"revoke","runFn","unlink","getProp","setProp","getProps","createChild"],p={get:(e,t,o)=>{if(e.runFn("assertScope"),t===O)return Reflect.get(e,t,o);const n=e.getProp("base");if(-1!==h.indexOf(t)||!((e,t)=>e.hasOwnProperty(t))(n,t))return Reflect.get(e,t,o);const a=e.getProp("accessPath").concat(t);if(!e.getProp("isPeeking")){if($.trackerNode&&r.id!==$.trackerNode.id){const t=$.trackerNode.proxy,o=null==t?void 0:t.getProp("propProperties");if(o.push({path:a,source:r.proxy}),e.setProp("propProperties",o),r.proxy)return((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r.proxy,a)}e.runFn("reportAccessPath",a)}const p=e.getProp("childProxies"),l=n[t];if(!j(l))return l;const u=p[t];return u&&u.base===l?u:p[t]=q(l,{accessPath:a,parentProxy:e,rootPath:c,useRevoke:s,useScope:i},r)}},l=new W({base:e,parentProxy:n,accessPath:o,rootPath:c,trackerNode:r,useRevoke:s,useScope:i}),{proxy:u,revoke:d}=Proxy.revocable(a,p);return F(u,"getProps",(function(){const e=Array.prototype.slice.call(arguments);return e.map(e=>this[O][e])})),F(u,"getProp",(function(){const e=Array.prototype.slice.call(arguments);return this[O][e[0]]})),F(u,"setProp",(function(){const e=Array.prototype.slice.call(arguments),t=e[0],r=e[1];return this[O][t]=r})),F(u,"runFn",(function(){const e=Array.prototype.slice.call(arguments),t=this[O][e[0]],r=e.slice(1);if("function"==typeof t)return t.apply(this,r)})),F(u,"unlink",(function(){return this.runFn("unlink")})),F(u,"createChild",(function(){const e=Array.prototype.slice.call(arguments),t=e[0]||{},o=e[1]||{};return q(t,{useRevoke:s,useScope:i,rootPath:c,...o},r)})),F(u,"revoke",(function(){this.getProp("useRevoke")&&d()})),F(u,O,l),u}A(W,T);let J=0;class G{constructor({parent:e,isSibling:t,base:r,useRevoke:o,useScope:n,useProxy:s,rootPath:i}){this.base=r,this.useRevoke=o,this.useScope=n,this.useProxy=s,this.rootPath=i||[],this.children=[],this.parent=e,this.prevSibling=null,this.nextSibling=null,this.proxy=null,this.id=`__TrackerNode_${J++}__`,this.isRevoked=!1,this.inScope=!1,this.updateParent(),t&&this.initPrevSibling(),this.base&&this.enterTrackerScope()}updateParent(){this.parent&&this.parent.children.push(this)}enterTrackerScope(){this.enterContext(),this.proxy=(this.useProxy?q:K)(this.base,{useRevoke:this.useRevoke,useScope:this.useScope,rootPath:this.rootPath},this)}enterContext(){$.trackerNode=this,this.inScope=!0}leaveContext(){this.inScope&&(this.inScope=!1,$.trackerNode=null),this.parent&&this.parent.inScope&&($.trackerNode=this.parent)}initPrevSibling(){if(this.parent){const e=this.parent.children,t=e[e.length-1];this.prevSibling=t,t&&(t.nextSibling=this)}}destroy(){if(this.parent){const e=this.parent.children.indexOf(this);this.parent.children.splice(e,1)}const e=this.prevSibling,t=this.nextSibling;e&&(e.nextSibling=t||null),t&&(t.prevSibling=e||null)}contains(e){if(e===this)return!0;if(!e)return!1;const t=e.parent;return!!t&&(t===this||this.contains(t))}revokeLastChild(){this.children.length&&this.children[this.children.length-1].revoke()}revokeUntil(e){if(e===this)return!0;if(e&&e.isRevoked)throw new Error("Assign a `revoked` parent is forbidden");return this.parent&&this.parent?this.parent.revokeUntil(e):this.revokeSelf()}revokeSelf(){var e;return this.children.length&&this.children.forEach(e=>{e.isRevoked||e.revokeSelf()}),this.isRevoked||(null===(e=this.proxy)||void 0===e||e.revoke(),this.isRevoked=!0),!0}revoke(){var e;this.parent&&(null===(e=this.proxy)||void 0===e||e.revoke(),$.trackerNode=this.parent)}hydrate(e,t={}){this.base=e||this.base,Object.keys(t||{}).forEach(e=>{this[e]=t[e]}),this.enterTrackerScope()}}class H{constructor({paths:e,autoRunFn:t,key:r,parent:o,displayName:n}){this.autoRunFn=t,this.paths=e,this.removers=[],this.dirty=!1,this.id=r,this.displayName=n,this.parent=o,this.children=[],this.parent&&this.parent.children.push(this)}destroyPatcher(){this.teardown(),this.children.length&&this.children.forEach(e=>e.destroyPatcher()),this.parent&&this.parent.removeChild(this),this.parent=null}appendTo(e){this.parent&&this.parent.removeChild(this),e&&(this.parent=e,-1===e.children.indexOf(this)&&e.children.push(this))}belongs(e){return!!e&&!!this.parent&&(this.parent===e||this.parent.belongs(e))}removeChild(e){const t=this.children.indexOf(e);-1!==t&&this.children.splice(t,1)}update({paths:e}){this.paths=e,this.dirty=!1,this.teardown()}addRemover(e){this.removers.push(e)}teardown(){this.removers.forEach(e=>e()),this.removers=[]}markDirty(){this.teardown()}markDirtyAll(){this.teardown(),this.children.length&&this.children.forEach(e=>e.markDirtyAll())}triggerAutoRun(){"function"==typeof this.autoRunFn&&this.autoRunFn()}}let Y=0;const z=({addListener:e})=>(e(),null),Q={};exports.Provider=({store:e,children:o,namespace:n,useProxy:c=!0,useRelinkMode:a=!0,strictMode:h=!1})=>{const{initialState:p,createReducer:l,createDispatch:y}=e,P=t.useRef(n||(()=>{let e;for(;void 0===e||d.hasOwnProperty(e)||!isNaN(+e);)e=Math.floor(Math.random()*f).toString(32);return d[e]=!0,e})()),g=t.useRef(new u({base:p,namespace:P.current,strictMode:h})),k=t.useMemo(()=>l(p),[]),[b,v]=t.useReducer(k,[]),x=v,m=t.useMemo(()=>y(x),[]);g.current.update(b);const S=t.useRef({...s,dispatch:m,useProxy:c,useRelinkMode:a,namespace:P.current,application:g.current});return r.createElement(i.Provider,{value:S.current},o)},exports.applyMiddleware=function(...e){const t=[...e];return e=>r=>{const o={...e(r),dispatch:void 0},{reducers:n,effects:s,initialState:i}=o,c={dispatch:(e,...t)=>o.dispatch(e,...t),getState:()=>i,reducers:n,effects:s},a=t.map(e=>e(c));return{...o,createDispatch:e=>(o.dispatch=function(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...r)=>e(t(...r)))}(...a)(e),o.dispatch)}}},exports.createStore=function e(t,r){if("function"==typeof r)return r(e)(t);const n=t.models,s=t.initialValue||{},i={},c={},a={};return Object.keys(n).forEach(e=>{const{state:t,reducers:r,effects:o}=n[e];i[e]={...t,...s[e]||{}},r&&(c[e]=r),o&&(a[e]=o)}),{initialState:i,effects:a,reducers:c,createReducer:(h=c,e=>(t,r)=>{const n=[].concat(r).reduce((t,r)=>{const{type:n,payload:s}=r,[i,c]=n.split("/"),a=h[i];if(a||o(!1),a[c]){const r=a[c](e[i],s);t.push({storeKey:i,changedValue:r})}else console.warn(`Do not have action '${c}'`);return t},[]);return n.length?n:[]})};var h},exports.logger=({getState:e})=>t=>r=>{const o=Date.now(),n=JSON.parse(JSON.stringify(e()));t(r),(e=>{const{prevState:t={},actions:r}=e;(e=>{const{initialActions:t,startTime:r,endTime:o}=e;let n="";[].concat(t).slice(0,2).forEach(({type:e})=>{n=n?`${n}__${e}`:e}),t.length>2&&(n=`${n}...`);let s="color: #7cb305; font-weight: bold";n.startsWith("@init")&&(s="color: #ff4d4f; font-weight: bold");const i=[];i.push(["action",s]),i.push([n,"color: inherit;"]),i.push([`@ ${k(r)}`,"color: gray; font-weight: lighter;"]),i.push([`(${o-r}ms)`,"color: gray; font-weight: lighter;"]),x(m(i))})(e),((e,t=!1)=>{const r=[];let o="currentState",n="color: #4CAF50; font-weight: bold";t&&(o="nextState",n="color: #4CAF50; font-weight: bold"),r.push([o,n]),b([...m(r),e])})(t),(e=>{const t=e.filter(({type:e})=>!e.startsWith("@init"));t.forEach(e=>S(e)),t.length&&v()})(r),v()})({actions:r,prevState:n,initialActions:r,startTime:o,endTime:Date.now()})},exports.observe=e=>{function n(s){const a=t.useRef(0),[h,p]=t.useState(0),l=t.useRef(),u=t.useRef(!1),d=(t.useRef(!0),t.useRef(0)),{application:f,useProxy:y,namespace:g,patcher:k,trackerNode:b,useRelinkMode:v,...x}=t.useContext(i),m=t.useRef(Y++),S=`${n.displayName}-${m.current}`,R=t.useRef(),N=t.useRef();a.current+=1,t.useEffect(()=>{}),R.current||(R.current=new H({paths:[],autoRunFn:()=>{p(e=>e+1),((e,t,r)=>{-1!==Object.keys(Q).indexOf(e)&&c("invalid re-render",e,t,r)})(S,R.current,N.current)},parent:k,key:P({namespace:g,componentName:S}),displayName:n.displayName})),N.current||(N.current=(({base:e,parent:t,useProxy:r=!0,useRevoke:n=!1,useScope:s=!0,rootPath:i=[]})=>{((e,t)=>{t===e&&o(!1)})(s,n);const c=(()=>{try{new Proxy({},{})}catch(e){return!1}return!0})()&&r,a=void 0!==t?t:$.trackerNode;let h=!1;return a?(a===$.trackerNode?n&&a.revokeLastChild():n&&$.trackerNode&&$.trackerNode.revokeUntil(a),$.trackerNode&&a===$.trackerNode.parent&&(h=!0)):$.trackerNode&&n&&$.trackerNode.revokeUntil(),new G({parent:a,isSibling:h,base:e,useRevoke:n,useScope:s,useProxy:c,rootPath:i})})({base:{},useProxy:y,useRevoke:!1,useScope:!0,parent:b,rootPath:[]})),N.current&&N.current.enterContext(),t.useEffect(()=>()=>{R.current&&R.current.destroyPatcher(),Q[S]=R.current},[]);const w=t.useCallback(()=>({trackerNode:N.current}),[]);if(N.current.proxy){const e=N.current.proxy;if(e.getProp("propProperties").forEach(e=>{try{const{source:t}=e,r=(null==t?void 0:t.getProp("rootPath"))[0],o=null==f?void 0:f.getStoreData(r);null==t||t.runFn("relinkBase",o)}catch(e){c("[observe rebase propProperties]",e)}}),v&&l.current){const t=null==f?void 0:f.getStoreData(l.current);e.runFn("rebase",t)}N.current.proxy.runFn("cleanup")}const O=t.useCallback(e=>{if(v){if(e&&!u.current){var t;l.current=e;const r=null==f?void 0:f.getStoreData(l.current);null===(t=N.current)||void 0===t||t.hydrate(r,{rootPath:[l.current]}),u.current=!0}}else{var r;l.current=e;const t=null==f?void 0:f.getStoreData(l.current);null===(r=N.current)||void 0===r||r.hydrate(t,{rootPath:[l.current]}),u.current=!0}},[]),j=t.useCallback(()=>{var e,t,r;if(null===(e=R.current)||void 0===e||e.appendTo(k),!(null===(t=N.current)||void 0===t?void 0:t.proxy))return;const o=N.current.proxy.runFn("getRemarkableFullPaths");null===(r=R.current)||void 0===r||r.update({paths:o}),R.current&&(null==f||f.addPatcher(R.current)),d.current+=1,N.current.leaveContext()},[]),E={...x,getData:w,application:f,useProxy:y,namespace:g,useRelinkMode:v,patcher:R.current,trackerNode:N.current,attachStoreName:O};return r.createElement(i.Provider,{value:E},r.createElement(r.Fragment,null,r.createElement(e,Object.assign({},s)),r.createElement(z,{addListener:j})))}return n.displayName=e.displayName||e.name||"ObservedComponent",n},exports.thunk=({getState:e,dispatch:t,effects:r})=>o=>(n,s)=>{if("function"==typeof n)return n(e=>{const r=([].concat(e)||[]).map(e=>{if(!e)return null;const{type:t,payload:r}=e,o={type:[s].concat(t.split("/")).slice(-2).join("/")};return r&&(o.payload=r),o}).filter(e=>!!e);r.length&&t&&t(r)},e);const i=[].concat(n),c=[],a=[];i.filter(e=>{if("[object Object]"===Object.prototype.toString.call(e)){const{type:t}=e;return!!t}return!1}).forEach((function(e){try{const{type:t}=e,o=t.split("/"),n=o[1],s=r[o[0]];return s&&s[n]?a.push(e):c.push(e)}catch(e){return!1}})),c.length&&o(c),a.forEach(e=>{const{type:o,payload:n}=e,s=o.split("/"),i=s[0],c=r[i][s[1]];Promise.resolve().then(()=>t&&t(c(n),i)).catch(e=>{console.error(e)})})},exports.useDispatch=()=>{const{dispatch:e}=t.useContext(i);return[e]},exports.useRelinx=e=>{const{dispatch:r,getData:n,attachStoreName:s}=t.useContext(i);("string"!=typeof e||""===e)&&o(!1),n||o(!1),s(e);const{trackerNode:c}=n();return c.proxy||o(!1),[c.proxy,r]};
//# sourceMappingURL=relinx.cjs.production.min.js.map
