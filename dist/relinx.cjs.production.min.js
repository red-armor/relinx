"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),r=e(t),o=e(require("invariant"));const s=()=>{},n={computation:null,getData:()=>({trackerNode:null}),dispatch:s,attachStoreName:s,useProxy:!0,namespace:null,patcher:null,trackerNode:null,useRelinkMode:!0,application:null};var i=t.createContext(n,()=>0);function c(...e){console.log("**DEBUG**",...e)}class a{constructor(e,t){this.prop=e||"root",this.parent=t,this.children={},this.patchers=[]}addPathNode(e,t){const r=e.length;e.reduce((e,o,s)=>{if(e.children[o]||(e.children[o]=new a(o,e)),s===r-1){const r=e.children[o];r.patchers.push(t),t.addRemover(()=>{const e=r.patchers.indexOf(t);-1!==e&&r.patchers.splice(e,1)})}return e.children[o]},this)}destroyPathNode(){try{this.patchers.forEach(e=>e.destroyPatcher()),this.children&&Object.keys(this.children).forEach(e=>{this.children[e].destroyPathNode()}),this.parent&&delete this.parent.children[this.prop]}catch(e){c("[PathNode destroy issue]",e)}}}const h=Function.call.bind(Object.prototype.toString),p=e=>"[object Object]"===h(e),l=(e,t)=>h(e)===h(t);class u{constructor({base:e,namespace:t,strictMode:r}){this.base=e,this.node=new a,this.pendingPatchers=[],this.namespace=t,this.strictMode=r}update(e){this.pendingPatchers=[];try{e.forEach(e=>this.treeShake(e)),e.forEach(e=>this.updateBase(e))}catch(e){c("[Application] update issue ",e)}const t=[],r=this.pendingPatchers.length;for(let e=0;e<r;e++){const r=this.pendingPatchers[e].patcher,o=t.length;let s=!1;for(let e=0;e<o;e++){const o=t[e];if(r.belongs(o)){s=!0;break}if(o.belongs(r)){t.splice(e,1),t.splice(e,0,r),s=!0;break}}s||t.push(r)}this.pendingPatchers.length&&this.pendingPatchers.forEach(({patcher:e})=>{e.triggerAutoRun()})}updateBase({storeKey:e,changedValue:t}){this.base[e]={...this.base[e]||{},...t}}treeShake({storeKey:e,changedValue:t}){const r=this.node.children[e],o=this.base[e],s=o,n={...o,...t};if(!r)return;const i=[],c=(e,t,r,o,n)=>{if((a=t)===(u=r)?0!==a||1/a==1/u:a!=a&&u!=u)return;var a,u,d;l(t,r)&&(p(d=r)||(e=>"[object Array]"===h(e))(d))||e.patchers.length&&(e.patchers.forEach(e=>{this.pendingPatchers.push({collections:o,patcher:e,operation:n})}),e.patchers.forEach(e=>e.markDirty()));const f=Object.keys(e.children);let y=f,P=[];const g=[];if(l(t,r)&&Array.isArray(r)){const e=r.length;e<t.length&&(y=f.filter(t=>parseInt(t,10)<e||"length"===t),P=f.filter(t=>parseInt(t,10)>=e&&(g.push({path:o.concat(t),isDelete:!0}),!0)))}if(p(r)&&p(t)){const o=Object.keys(r),s=function(e=[],t){const r=[];for(let o=0;o<e.length;o++){const s=e[o];-1===t.indexOf(s)&&r.push(s)}return r}(Object.keys(t),o);s.length&&i.push(((e,t)=>{t.forEach(t=>{const r=e.children[t];r&&r.destroyPathNode()})}).bind(null,e,s))}this.strictMode&&y.forEach(r=>{t&&void 0!==t[r]||e.children[r].patchers.forEach(e=>{const t=e.displayName,n=o.concat(r).join(".");console.warn("root base value ",s),console.warn(`Maybe you are using an un-declared props %c${n}`+` %cin Component %c${t} %cYou'd better declare this prop in model first,`+"or component may not re-render when value changes on ES5.","color: #ff4d4f; font-weight: bold","","color: #7cb305; font-weight: bold","")})}),y.forEach(s=>{c(e.children[s],t?t[s]:void 0,r?r[s]:void 0,o.concat(s),g)}),P.length&&i.push(((e,t)=>{t.forEach(t=>{const r=e.children[t];r&&r.destroyPathNode()})}).bind(null,e,P))};c(r,o,n,[e],[]),i.forEach(e=>e())}addPatcher(e){e.paths.forEach(t=>{this.node.addPathNode(t,e)})}getStoreData(e){return this.base[e]}}const d={},f=Math.pow(2,24),y={},P=({namespace:e,componentName:t})=>{y[e]||(y[e]={});const r=y[e][t]||0;return y[e][t]=r+1,`${e}_${t}_patcher_${r}`};class g{constructor(e){const t=e.models,r=e.initialValue||{};this._state={},this._reducers={},this._effects={},this._pendingActions=[],Object.keys(t).forEach(e=>{this.injectModel(e,t[e],r[e])}),this.dispatch=()=>{},this._application=null,this.subscriptions={},this._count=0}getState(){return this._state}getReducers(){return this._reducers}getEffects(){return this._effects}setValue(e){const t=[].concat(e).reduce((e,t)=>{if(!this._application)return[];const{type:r,payload:o}=t,[s,n]=r.split("/"),i=this._reducers[s];if(i)if(i[n]){const t=i[n](this._application.base[s],o);e.push({storeKey:s,changedValue:t})}else console.warn(`Do not have action '${n}'`);else this._pendingActions.push(t);return e},[]);if(t.length){var r,o,s;const e=t.reduce((e,t)=>{const{storeKey:r,changedValue:o}=t;return e[r]=o,e},{}),n={...null===(r=this._application)||void 0===r?void 0:r.base},i={...null===(o=this._application)||void 0===o?void 0:o.base,...e};null===(s=this._application)||void 0===s||s.update(t);for(let t in this.subscriptions)(0,this.subscriptions[t])({oldState:n,newState:i,diff:e})}}bindApplication(e){this._application=e}decorateDispatch(e){this.dispatch=e(this.setValue.bind(this))}generateSubscriptionKey(){return`store_${this._count++}`}subscribe(e){const t=this.generateSubscriptionKey();return this.subscriptions[t]=e,()=>delete this.subscriptions[t]}injectModel(e,t,r={}){var o,s;const{state:n,reducers:i={},effects:c={}}=t;let a=(null===(o=this._application)||void 0===o?void 0:o.getStoreData(e))||{...n,...r};const h=this._pendingActions.filter(t=>{const{type:r,payload:o}=t,[s,n]=r.split("/");if(r===s){const e=i[n],r=c[n];let s=a;"function"==typeof e?(s=e(a,o),a={...a,...s}):"function"==typeof r?this.dispatch(t):console.warn(`Maybe you have dispatched an unregistered model's effect action(${t})`)}return s!==e});this._state[e]=a,this._pendingActions=h,null===(s=this._application)||void 0===s||s.updateBase({storeKey:e,changedValue:a}),i&&(this._reducers[e]=i),c&&(this._effects[e]=c)}}class k{constructor(){this.collections=[]}addAction(e,t,r){this.collections.push({actionKey:e,namespace:t,remover:()=>{const t=this.collections.findIndex(({actionKey:t})=>t===e);-1!==t&&this.collections.splice(t,1)},actions:r})}}var b=new k;const v=e=>{[].concat(e).forEach(e=>{const{namespace:t,actions:r}=e;t||o(!1),r||o(!1);const s=Math.floor(Math.random()*f).toString(32);b.addAction(s,t,r)})},x=(e,t=2)=>`00${e}`.slice(-t),S=e=>{const t=new Date(e),r=t.getHours(),o=t.getMinutes(),s=t.getSeconds(),n=t.getMilliseconds();return`${x(r)}:${x(o)}:${x(s)}.${x(n,3)}`},m=Function.apply.bind(console.log,null),N=console.groupEnd,R=Function.apply.bind(console.groupCollapsed,null),w=e=>{const{text:t,styles:r}=e.reduce((e,t)=>{const{text:r,styles:o}=e,[s,n]=t;return{text:`${r}%c ${s}`,styles:[].concat(o,n)}},{text:"",styles:[]});return[t,...r]},O=e=>{const{type:t,actions:r={},effects:o={},payload:s,actionType:n}=e,i=Object.keys(r),c=Object.keys(o);(e=>{const{type:t,payload:r="",actionType:o="action",style:s}=e,n=[];t&&(n.push([o,"color: #eb2f96; font-weight: bold"]),n.push([t,"color: #722ed1; font-weight: bold"])),"line"===s?m([...w(n),r]):R([...w(n),r])})(i.length||c.length?{type:t,payload:s,actionType:n}:{type:t,payload:s,actionType:n,style:"line"}),i.forEach(e=>{O(r[e])}),c.forEach(e=>{O(o[e])}),(i.length||c.length)&&N()},A=Function.call.bind(Object.prototype.toString),E=e=>"undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys(e):void 0!==Object.getOwnPropertySymbols?Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e)):Object.getOwnPropertyNames(e),j=e=>!!e&&("object"==typeof e||"function"==typeof e),_="undefined"!=typeof Symbol?Symbol("tracker"):"__tracker__",F=e=>-1!==["[object Object]","[object Array]"].indexOf(A(e));function C(e){if(Array.isArray(e))return e.slice();const t=Object.create(Object.getPrototypeOf(e));return E(e).forEach(r=>{t[r]=e[r]}),t}const $=(e,t)=>{e.prototype=Object.create(t.prototype),e.prototype.constructor=e},M=(e,t,r)=>{Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0})},D=(e,t)=>{Object.defineProperty(e,t,{enumerable:!1,configurable:!1})},T={trackerNode:null},K=e=>e.join("_"),L=e=>{const t=e.slice(),r={},o=[];for(let e=t.length-1;e>=0;e--){const s=t[e].slice(),n=s.length;let i=!1;for(let e=0;e<n;e++){const e=K(s),t=r[e]||0;if(i)r[e]=t+1,s.pop();else{if(t){r[e]=t-1;break}{const e=s.slice(),t=K(e);o.find(e=>K(e)===t)||o.push(e),i=!0,s.pop()}}}}return o};function V(){}const B=V.prototype;B.assertLink=function(e){const t=this.getProp("trackerNode");t||o(!1),T.trackerNode===t&&o(!1)},B.reportAccessPath=function(e){const t=this.getProp("paths"),r=this.getProp("parentProxy");t.push(e),r&&r.runFn("reportAccessPath",e)},B.cleanup=function(){this.setProp("paths",[]),this.setProp("propProperties",[])},B.unlink=function(){return this.getProp("base")},B.relink=function(e,t){try{this.runFn("assertLink","relink");const r=this;let o=e.slice(),s=o.pop();const n=e.length;let i=t;for(let t=0;t<n;t++){const r=e[t];if(void 0===i[r]){o=e.slice(0,t-1),s=e[t-1];break}i=i[r]}((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r,o).relinkProp(s,i)}catch(e){}},B.relinkProp=function(e,t){this.runFn("assertLink","relinkProp");const r=this.getProp("base"),o=this.getProp("childProxies"),s=this.getProp("accessPath");Array.isArray(r)&&this.setProp("base",r.filter(e=>e)),this.getProp("base")[e]=t,F(t)&&(o[e]=this.createChild(t,{accessPath:s.concat(e),parentProxy:this}))},B.relinkBase=function(e){this.runFn("assertLink","rebase"),this.runFn("rebase",e)},B.rebase=function(e){try{this.setProp("base",e)}catch(e){}},B.setRemarkable=function(){const e=this.getProp("accessPath"),t=this.getProp("parentProxy");return!!t&&(t.runFn("reportAccessPath",e),!0)},B.getRemarkableFullPaths=function(){const e=this.getProp("paths"),t=this.getProp("propProperties"),r=this.getProp("rootPath"),o=L(e).map(e=>r.concat(e)),s=t.map(e=>{const{path:t,source:r}=e;return(null==r?void 0:r.getProp("rootPath")).concat(t)}),n=L(s);return o.concat(n)},B.assertScope=function(){if(!this.getProp("useScope"))return;const e=this.getProp("trackerNode");if(e){if(!e.contains(T.trackerNode)&&T.trackerNode)throw new Error(e.id+"is not child node of "+T.trackerNode.id+"Property only could be accessed by self node or parent node.")}else console.warn("trackerNode is undefined, which means you are using createTracker function directly.Maybe you should create TrackerNode object.")},D(B,"assertLink"),D(B,"reportAccessPath"),D(B,"cleanup"),D(B,"unlink"),D(B,"relink"),D(B,"relinkBase"),D(B,"relinkProp"),D(B,"setRemarkable"),D(B,"getRemarkableFullPaths"),D(B,"rebase"),D(B,"assertScope");let I=0;const U=function({accessPath:e,parentProxy:t,rootPath:r,base:o,trackerNode:s,useRevoke:n,useScope:i}){M(this,"id",`ES5Tracker_${I++}`),M(this,"trackerNode",s),M(this,"accessPath",e),M(this,"rootPath",r),M(this,"type",Array.isArray(o)?"array":"object"),M(this,"base",o),M(this,"parentProxy",t),M(this,"childProxies",{}),M(this,"isPeeking",!1),M(this,"propProperties",[]),M(this,"paths",[]),M(this,"useRevoke",n),M(this,"useScope",i),M(this,"isRevoked",!1),M(this,"assertRevoke",(function(){if(this.getProp("useRevoke")&&this.getProp("isRevoked"))throw new Error("Cannot use a proxy that has been revoked. Did you pass an object to an async process? ")}))};function W(e,t,r){const{accessPath:o=[],parentProxy:s,useRevoke:n,useScope:i,rootPath:c=[]}=t||{};if(!j(e))throw new TypeError("Cannot create proxy with a non-object as target or handler");const a=C(e);var h,p;if(h=e,p=t=>{const o=Object.getOwnPropertyDescriptor(e,t);!function(e,t,o){const s={enumerable:o,configurable:!1,get(){this.runFn("assertRevoke"),this.runFn("assertScope");const o=this.getProp("base"),s=this.getProp("accessPath"),a=this.getProp("childProxies"),h=this.getProp("isPeeking"),p=o[t],l=s.concat(`${t}`);if(!h){if(T.trackerNode&&r.id!==T.trackerNode.id){const e=T.trackerNode.proxy,t=null==e?void 0:e.getProp("propProperties");if(t.push({path:l,source:r.proxy}),this.setProp("propProperties",t),r.proxy)return((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r.proxy,l)}this.runFn("reportAccessPath",l)}if(!F(p))return p;const u=a[t];return u&&u.base===p?u:a[t]=W(p,{accessPath:l,parentProxy:e,rootPath:c,useRevoke:n,useScope:i},r)}};Object.defineProperty(e,t,s)}(a,t,(null==o?void 0:o.enumerable)||!1)},Array.isArray(h)?h.forEach((e,t)=>p(t)):j(h)&&E(h).forEach(e=>p(e)),Array.isArray(e)){const e=Object.getPrototypeOf([]),t=Object.getOwnPropertyNames(e),o=(e,t,o=!0)=>function(){const s=Array.prototype.slice.call(arguments);if(this.runFn("assertRevoke"),o){const e=this.getProp("accessPath"),t=this.getProp("isPeeking"),o=e.concat("length");if(!t){if(T.trackerNode&&r.id!==T.trackerNode.id){const e=T.trackerNode.proxy,t=null==e?void 0:e.getProp("propProperties");t.push({path:o,source:r.proxy}),this.setProp("propProperties",t)}this.runFn("reportAccessPath",o)}}return e.apply(t,s)};t.forEach(t=>{const r=e[t];if("function"==typeof r){const e=["concat","copyWith","fill","find","findIndex","lastIndexOf","pop","push","reverse","shift","unshift","slice","sort","splice","includes","indexOf","join","keys","entries","forEach","filter","flat","flatMap","map","every","some","reduce","reduceRight"];-1!==["concat","copyWith"].indexOf(t)?M(a,t,o(r,a,!1)):-1!==e.indexOf(t)&&M(a,t,o(r,a))}})}const l=new U({base:e,parentProxy:s,accessPath:o,rootPath:c,trackerNode:r,useRevoke:n,useScope:i});return M(a,"getProps",(function(){const e=Array.prototype.slice.call(arguments);return e.map(e=>this[_][e])})),M(a,"getProp",(function(){const e=Array.prototype.slice.call(arguments);return this[_][e[0]]})),M(a,"setProp",(function(){const e=Array.prototype.slice.call(arguments),t=e[0],r=e[1];return this[_][t]=r})),M(a,"runFn",(function(){const e=Array.prototype.slice.call(arguments),t=this[_][e[0]],r=e.slice(1);if("function"==typeof t)return t.apply(this,r)})),M(a,"unlink",(function(){return this.runFn("unlink")})),M(a,"createChild",(function(){const e=Array.prototype.slice.call(arguments),t=e[0]||{},o=e[1]||{};return W(t,{useRevoke:n,useScope:i,rootPath:c,...o},r)})),M(a,"revoke",(function(){this.getProp("useRevoke")&&this.setProp("isRevoked",!0)})),M(a,_,l),a}var q,G;$(U,V),(G=q||(q={})).Object="object",G.Array="array";let J=0;const H=function({accessPath:e,parentProxy:t,rootPath:r,base:o,trackerNode:s,useRevoke:n,useScope:i}){M(this,"id",`ProxyTracker_${J++}`),M(this,"trackerNode",s),M(this,"accessPath",e),M(this,"rootPath",r),M(this,"type",Array.isArray(o)?q.Array:q.Object),M(this,"base",o),M(this,"parentProxy",t),M(this,"childProxies",{}),M(this,"isPeeking",!1),M(this,"propProperties",[]),M(this,"paths",[]),M(this,"useRevoke",n),M(this,"useScope",i)};function Y(e,t,r){const{accessPath:o=[],parentProxy:s,useRevoke:n,useScope:i,rootPath:c=[]}=t||{};if(!j(e))throw new TypeError("Cannot create proxy with a non-object as target or handler");const a=C(e),h=[_,"revoke","runFn","unlink","getProp","setProp","getProps","createChild"],p={get:(e,t,o)=>{if(e.runFn("assertScope"),t===_)return Reflect.get(e,t,o);const s=e.getProp("base");if(-1!==h.indexOf(t)||!((e,t)=>e.hasOwnProperty(t))(s,t))return Reflect.get(e,t,o);const a=e.getProp("accessPath").concat(t);if(!e.getProp("isPeeking")){if(T.trackerNode&&r.id!==T.trackerNode.id){const t=T.trackerNode.proxy,o=null==t?void 0:t.getProp("propProperties");if(o.push({path:a,source:r.proxy}),e.setProp("propProperties",o),r.proxy)return((e,t)=>t.reduce((e,t)=>{e.setProp("isPeeking",!0);const r=e[t];return e.setProp("isPeeking",!1),r},e))(r.proxy,a)}e.runFn("reportAccessPath",a)}const p=e.getProp("childProxies"),l=s[t];if(!F(l))return l;const u=p[t];return u&&u.base===l?u:p[t]=Y(l,{accessPath:a,parentProxy:e,rootPath:c,useRevoke:n,useScope:i},r)}},l=new H({base:e,parentProxy:s,accessPath:o,rootPath:c,trackerNode:r,useRevoke:n,useScope:i}),{proxy:u,revoke:d}=Proxy.revocable(a,p);return M(u,"getProps",(function(){const e=Array.prototype.slice.call(arguments);return e.map(e=>this[_][e])})),M(u,"getProp",(function(){const e=Array.prototype.slice.call(arguments);return this[_][e[0]]})),M(u,"setProp",(function(){const e=Array.prototype.slice.call(arguments),t=e[0],r=e[1];return this[_][t]=r})),M(u,"runFn",(function(){const e=Array.prototype.slice.call(arguments),t=this[_][e[0]],r=e.slice(1);if("function"==typeof t)return t.apply(this,r)})),M(u,"unlink",(function(){return this.runFn("unlink")})),M(u,"createChild",(function(){const e=Array.prototype.slice.call(arguments),t=e[0]||{},o=e[1]||{};return Y(t,{useRevoke:n,useScope:i,rootPath:c,...o},r)})),M(u,"revoke",(function(){this.getProp("useRevoke")&&d()})),M(u,_,l),u}$(H,V);let z=0;class Q{constructor({parent:e,isSibling:t,base:r,useRevoke:o,useScope:s,useProxy:n,rootPath:i}){this.base=r,this.useRevoke=o,this.useScope=s,this.useProxy=n,this.rootPath=i||[],this.children=[],this.parent=e,this.prevSibling=null,this.nextSibling=null,this.proxy=null,this.id=`__TrackerNode_${z++}__`,this.isRevoked=!1,this.inScope=!1,this.updateParent(),t&&this.initPrevSibling(),this.base&&this.enterTrackerScope()}updateParent(){this.parent&&this.parent.children.push(this)}enterTrackerScope(){this.enterContext(),this.proxy=(this.useProxy?Y:W)(this.base,{useRevoke:this.useRevoke,useScope:this.useScope,rootPath:this.rootPath},this)}enterContext(){T.trackerNode=this,this.inScope=!0}leaveContext(){this.inScope&&(this.inScope=!1,T.trackerNode=null),this.parent&&this.parent.inScope&&(T.trackerNode=this.parent)}initPrevSibling(){if(this.parent){const e=this.parent.children,t=e[e.length-1];this.prevSibling=t,t&&(t.nextSibling=this)}}destroy(){if(this.parent){const e=this.parent.children.indexOf(this);this.parent.children.splice(e,1)}const e=this.prevSibling,t=this.nextSibling;e&&(e.nextSibling=t||null),t&&(t.prevSibling=e||null)}contains(e){if(e===this)return!0;if(!e)return!1;const t=e.parent;return!!t&&(t===this||this.contains(t))}revokeLastChild(){this.children.length&&this.children[this.children.length-1].revoke()}revokeUntil(e){if(e===this)return!0;if(e&&e.isRevoked)throw new Error("Assign a `revoked` parent is forbidden");return this.parent&&this.parent?this.parent.revokeUntil(e):this.revokeSelf()}revokeSelf(){var e;return this.children.length&&this.children.forEach(e=>{e.isRevoked||e.revokeSelf()}),this.isRevoked||(null===(e=this.proxy)||void 0===e||e.revoke(),this.isRevoked=!0),!0}revoke(){var e;this.parent&&(null===(e=this.proxy)||void 0===e||e.revoke(),T.trackerNode=this.parent)}hydrate(e,t={}){this.base=e||this.base,Object.keys(t||{}).forEach(e=>{this[e]=t[e]}),this.enterTrackerScope()}}class X{constructor({paths:e,autoRunFn:t,key:r,parent:o,displayName:s}){this.autoRunFn=t,this.paths=e,this.removers=[],this.dirty=!1,this.id=r,this.displayName=s,this.parent=o,this.children=[],this.parent&&this.parent.children.push(this)}destroyPatcher(){this.teardown(),this.children.length&&this.children.forEach(e=>e.destroyPatcher()),this.parent&&this.parent.removeChild(this),this.parent=null}appendTo(e){this.parent&&this.parent.removeChild(this),e&&(this.parent=e,-1===e.children.indexOf(this)&&e.children.push(this))}belongs(e){return!!e&&!!this.parent&&(this.parent===e||this.parent.belongs(e))}removeChild(e){const t=this.children.indexOf(e);-1!==t&&this.children.splice(t,1)}update({paths:e}){this.paths=e,this.dirty=!1,this.teardown()}addRemover(e){this.removers.push(e)}teardown(){this.removers.forEach(e=>e()),this.removers=[]}markDirty(){this.teardown()}markDirtyAll(){this.teardown(),this.children.length&&this.children.forEach(e=>e.markDirtyAll())}triggerAutoRun(){"function"==typeof this.autoRunFn&&this.autoRunFn()}}let Z=0;const ee=({addListener:e})=>(e(),null),te={};exports.Provider=function({store:e,children:o,namespace:s,useProxy:c=!0,useRelinkMode:a=!0,strictMode:h=!1,useScope:p=!0}){const l=t.useRef(s||(()=>{let e;for(;void 0===e||d.hasOwnProperty(e)||!isNaN(+e);)e=Math.floor(Math.random()*f).toString(32);return d[e]=!0,e})()),y=t.useRef(new u({base:e.getState(),namespace:l.current,strictMode:h}));e.bindApplication(y.current);const P=e.dispatch,g=t.useRef({...n,dispatch:P,useProxy:c,useScope:p,useRelinkMode:a,namespace:l.current,application:y.current});return r.createElement(i.Provider,{value:g.current},o)},exports.applyMiddleware=function(...e){const t=[...e];return e=>r=>{const o=e(r),s=o.getState(),n={dispatch:(e,...t)=>o.dispatch(e,...t),getState:()=>s,store:o},i=t.map(e=>e(n));return o.decorateDispatch(function(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce((e,t)=>(...r)=>e(t(...r)))}(...i)),o}},exports.createStore=function e(t,r){return"function"==typeof r?r(e)(t):new g(t)},exports.logger=({getState:e})=>t=>r=>{if("function"!=typeof r){const o=Date.now(),s=JSON.parse(JSON.stringify(e()));t(r),(e=>{const{prevState:t={},actions:r}=e;(e=>{const{initialActions:t,startTime:r,endTime:o}=e;let s="";[].concat(t).slice(0,2).forEach(({type:e})=>{s=s?`${s}__${e}`:e}),t.length>2&&(s=`${s}...`);let n="color: #7cb305; font-weight: bold";s.startsWith("@init")&&(n="color: #ff4d4f; font-weight: bold");const i=[];i.push(["action",n]),i.push([s,"color: inherit;"]),i.push([`@ ${S(r)}`,"color: gray; font-weight: lighter;"]),i.push([`(${o-r}ms)`,"color: gray; font-weight: lighter;"]),R(w(i))})(e),((e,t=!1)=>{const r=[];let o="currentState",s="color: #4CAF50; font-weight: bold";t&&(o="nextState",s="color: #4CAF50; font-weight: bold"),r.push([o,s]),m([...w(r),e])})(t),(e=>{const t=e.filter(({type:e})=>!e.startsWith("@init"));t.forEach(e=>O(e)),t.length&&N()})(r),N()})({actions:r,prevState:s,initialActions:r,startTime:o,endTime:Date.now()})}},exports.observe=e=>{function o(s){const n=t.useRef(0),[a,h]=t.useState(0),p=t.useRef(),l=t.useRef(!1),u=(t.useRef(!0),t.useRef(0)),{application:d,useProxy:f,useScope:y,namespace:g,patcher:k,trackerNode:b,useRelinkMode:v,...x}=t.useContext(i),S=t.useRef(Z++),m=`${o.displayName}-${S.current}`,N=t.useRef(),R=t.useRef(null);n.current+=1,t.useEffect(()=>{}),N.current||(N.current=new X({paths:[],autoRunFn:()=>{h(e=>e+1),((e,t,r)=>{-1!==Object.keys(te).indexOf(e)&&c("invalid re-render",e,t,r)})(m,N.current,R.current)},parent:k,key:P({namespace:g,componentName:m}),displayName:o.displayName})),R.current||(R.current=(({base:e,parent:t,useProxy:r=!0,useRevoke:o=!1,useScope:s=!0,rootPath:n=[]})=>{const i=(()=>{try{new Proxy({},{})}catch(e){return!1}return!0})()&&r,c=void 0!==t?t:T.trackerNode;let a=!1;return c?(c===T.trackerNode?o&&c.revokeLastChild():o&&T.trackerNode&&T.trackerNode.revokeUntil(c),T.trackerNode&&c===T.trackerNode.parent&&(a=!0)):T.trackerNode&&o&&T.trackerNode.revokeUntil(),new Q({parent:c,isSibling:a,base:e,useRevoke:o,useScope:s,useProxy:i,rootPath:n})})({base:{},useProxy:f,useRevoke:!1,useScope:y,parent:b,rootPath:[]})),R.current&&R.current.enterContext(),t.useEffect(()=>()=>{N.current&&N.current.destroyPatcher(),te[m]=N.current},[]);const w=t.useCallback(()=>({trackerNode:R.current||null}),[]);if(R.current.proxy){const e=R.current.proxy;if(e.getProp("propProperties").forEach(e=>{try{const{source:t}=e,r=(null==t?void 0:t.getProp("rootPath"))[0],o=null==d?void 0:d.getStoreData(r);null==t||t.runFn("relinkBase",o)}catch(e){c("[observe rebase propProperties]",e)}}),v&&p.current){const t=null==d?void 0:d.getStoreData(p.current);e.runFn("rebase",t)}R.current.proxy.runFn("cleanup")}const O=t.useCallback(e=>{if(v){if(e&&!l.current){var t;p.current=e;const r=null==d?void 0:d.getStoreData(p.current);null===(t=R.current)||void 0===t||t.hydrate(r,{rootPath:[p.current]}),l.current=!0}}else{var r;p.current=e;const t=null==d?void 0:d.getStoreData(p.current);null===(r=R.current)||void 0===r||r.hydrate(t,{rootPath:[p.current]}),l.current=!0}},[]),A=t.useCallback(()=>{var e,t,r;if(null===(e=N.current)||void 0===e||e.appendTo(k),!(null===(t=R.current)||void 0===t?void 0:t.proxy))return void(R.current&&R.current.leaveContext());const o=R.current.proxy.runFn("getRemarkableFullPaths");null===(r=N.current)||void 0===r||r.update({paths:o}),N.current&&(null==d||d.addPatcher(N.current)),u.current+=1,R.current.leaveContext()},[]),E={...x,getData:w,application:d,useProxy:f,useScope:y,namespace:g,useRelinkMode:v,patcher:N.current,trackerNode:R.current||null,attachStoreName:O};return r.createElement(i.Provider,{value:E},r.createElement(r.Fragment,null,r.createElement(e,Object.assign({},s)),r.createElement(ee,{addListener:A})))}return o.displayName=e.displayName||e.name||"ObservedComponent",o},exports.thunk=({getState:e,dispatch:t,store:r})=>o=>(s,n)=>{if("function"==typeof s)return s(e=>{const r=([].concat(e)||[]).map(e=>{if(!e)return null;const{type:t,payload:r}=e,o={type:[n].concat(t.split("/")).slice(-2).join("/")};return r&&(o.payload=r),o}).filter(e=>!!e);r.length&&t&&t(r)},e);const i=[].concat(s),c=[],a=[];i.filter(e=>{if("[object Object]"===Object.prototype.toString.call(e)){const{type:t}=e;return!!t}return!1}).forEach((function(e){try{const{type:t}=e,o=t.split("/"),s=o[0],n=o[1],i=r.getEffects()[s];return i&&i[n]?a.push(e):c.push(e)}catch(e){return!1}})),c.length&&o(c),a.forEach(e=>{const{type:o,payload:s}=e,n=o.split("/"),i=n[0],c=n[1],a=r.getEffects()[i];t&&t((0,a[c])(s),i)})},exports.useDispatch=()=>{const{dispatch:e}=t.useContext(i);return[e]},exports.useGlobal=()=>[b.collections,v],exports.useNamespace=()=>{const{namespace:e}=t.useContext(i);return e},exports.useRelinx=e=>{const{dispatch:r,getData:s,attachStoreName:n}=t.useContext(i);("string"!=typeof e||""===e)&&o(!1),s||o(!1),n(e);const{trackerNode:c}=s();return c.proxy||o(!1),[c.proxy,r]};
//# sourceMappingURL=relinx.cjs.production.min.js.map
