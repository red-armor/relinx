{"version":3,"file":"relinx.esm.js","sources":["../src/context.ts","../src/utils/infoLog.ts","../src/PathNode.ts","../src/utils/toString.ts","../src/utils/ifType.ts","../src/utils/shallowEqual.ts","../src/Application.ts","../src/utils/key.ts","../src/Provider.tsx","../src/utils/compose.ts","../src/applyMiddleware.ts","../src/Store.ts","../src/createStore.ts","../src/hooks/useRelinx.ts","../src/hooks/useDispatch.ts","../src/hooks/useNamespace.ts","../src/globalHelper.ts","../src/hooks/useGlobal.ts","../src/middleware/thunk.ts","../src/middleware/logger/utils.ts","../src/middleware/logger/print.ts","../src/middleware/logger/index.ts","../src/Patcher.ts","../src/observe.tsx"],"sourcesContent":["import { createContext } from 'react';\nimport { ContextDefaultValue } from './types';\n\nconst calculateChangeBits = () => 0b00;\nconst noop = () => {};\n\nexport const defaultValue = {\n  computation: null,\n  dispatch: noop,\n  attachStoreName: noop,\n  useProxy: true,\n  namespace: null,\n  patcher: null,\n  trackerNode: null,\n  useRelinkMode: true,\n  application: null,\n};\n\n// @ts-ignore\nexport default createContext<ContextDefaultValue<T, M>>(\n  defaultValue,\n  // @ts-ignore\n  calculateChangeBits\n);\n","/**\n * Intentional info-level logging for clear separation from ad-hoc console debug logging.\n */\nfunction infoLog(...args: Array<any>) {\n  console.log('**DEBUG**', ...args); // eslint-disable-line\n}\n\nexport default infoLog;\n","import infoLog from './utils/infoLog';\nimport Patcher from './Patcher';\n\nconst DEBUG = false;\n\ninterface Children {\n  [key: string]: PathNode;\n}\n\nclass PathNode {\n  private parent: PathNode | undefined;\n  public patchers: Array<Patcher>;\n  public children: Children;\n  private prop: string;\n\n  constructor(prop?: string, parent?: PathNode) {\n    this.prop = prop || 'root';\n\n    this.parent = parent;\n    this.children = {};\n    this.patchers = [];\n  }\n\n  addPathNode(path: Array<string>, patcher: Patcher) {\n    try {\n      const len = path.length;\n      path.reduce<PathNode>((node: PathNode, cur: string, index: number) => {\n        // path中前面的值都是为了让我们定位到最后的需要关心的位置\n        if (!node.children[cur]) node.children[cur] = new PathNode(cur, node);\n        // 只有到达`path`的最后一个`prop`时，才会进行patcher的添加\n        if (index === len - 1) {\n          const childNode = node.children[cur];\n          if (DEBUG) {\n            infoLog('[PathNode add patcher]', childNode, patcher);\n          }\n          if (childNode.patchers) {\n            childNode.patchers.push(patcher);\n            patcher.addRemover(() => {\n              const index = childNode.patchers.indexOf(patcher);\n\n              if (DEBUG) {\n                infoLog('[PathNode remove patcher]', patcher.id, childNode);\n              }\n              if (index !== -1) {\n                childNode.patchers.splice(index, 1);\n              }\n            });\n          }\n        }\n        return node.children[cur];\n      }, this);\n    } catch (err) {\n      // console.log('err ', err)\n    }\n  }\n\n  destroyPathNode() {\n    try {\n      this.patchers.forEach(patcher => patcher.destroyPatcher());\n\n      if (this.children) {\n        const childKeys = Object.keys(this.children);\n        childKeys.forEach(key => {\n          const pathNode = this.children[key];\n          pathNode.destroyPathNode();\n        });\n      }\n\n      if (this.parent) {\n        delete this.parent.children[this.prop];\n      }\n    } catch (err) {\n      infoLog('[PathNode destroy issue]', err);\n    }\n  }\n}\n\nexport default PathNode;\n","const toString = Function.call.bind(Object.prototype.toString);\n\nexport default toString;\n","import toString from './toString';\n\nexport const isPresent = (o: any) => typeof o !== 'undefined';\nexport const isObject = (obj: any) => toString(obj) === '[object Object]';\nexport const isArray = (obj: any) => toString(obj) === '[object Array]';\nexport const isNumber = (obj: any) => toString(obj) === '[object Number]';\nexport const isString = (obj: any) => toString(obj) === '[object String]';\nexport const isBoolean = (obj: any) => toString(obj) === '[object Boolean]';\n\nexport const isMutable = (obj: any) => isObject(obj) || isArray(obj);\nexport const isPrimitive = (obj: any) =>\n  isNumber(obj) || isString(obj) || isBoolean(obj);\nexport const isTypeEqual = (o1: any, o2: any) => toString(o1) === toString(o2);\n\nexport const isStrictEmptyObject = (obj: any) => {\n  if (!isObject(obj)) return false;\n\n  for (const prop in obj) { // eslint-disable-line\n    if (obj.hasOwnProperty(prop)) return false // eslint-disable-line\n  }\n  return true;\n};\n\nexport const isStrictEmptyArray = (arr: any) => isArray(arr) && !arr.length;\n\nexport const hasEmptyItem = (...args: Array<any>) =>\n  args.some(arg => isStrictEmptyArray(arg) || isStrictEmptyObject(arg));\n","// https://github.com/facebook/react/blob/144328fe81719e916b946e22660479e31561bb0b/packages/shared/shallowEqual.js#L36-L68\n\n/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n */\n\n/* eslint-disable no-self-compare */\n\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\n/**\n * inlined Object.is polyfill to avoid requiring consumers ship their own\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is\n */\nfunction is(x: any, y: any) {\n  // SameValue algorithm\n  if (x === y) {\n    // Steps 1-5, 7-10\n    // Steps 6.b-6.e: +0 != -0\n    // Added the nonzero y check to make Flow happy, but it is redundant\n    return x !== 0 || y !== 0 || 1 / x === 1 / y;\n  }\n  // Step 6.a: NaN == NaN\n  return x !== x && y !== y;\n}\n\n/**\n * Performs equality by iterating through keys on an object and returning false\n * when any key has values which are not strictly equal between the arguments.\n * Returns true when the values of all keys are strictly equal.\n */\nfunction shallowEqual(objA: any, objB: any) {\n  if (is(objA, objB)) {\n    return true;\n  }\n\n  if (\n    typeof objA !== 'object' ||\n    objA === null ||\n    typeof objB !== 'object' ||\n    objB === null\n  ) {\n    return false;\n  }\n\n  const keysA = Object.keys(objA);\n  const keysB = Object.keys(objB);\n\n  if (keysA.length !== keysB.length) {\n    return false;\n  }\n\n  // Test for A's keys different from B.\n  for (let i = 0; i < keysA.length; i++) {\n    if (\n      !hasOwnProperty.call(objB, keysA[i]) ||\n      !is(objA[keysA[i]], objB[keysA[i]])\n    ) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport default shallowEqual;\n","import PathNode from './PathNode';\nimport infoLog from './utils/infoLog';\nimport { isTypeEqual, isPrimitive, isMutable } from './utils/ifType';\nimport shallowEqual from './utils/shallowEqual';\nimport {\n  IApplication,\n  GenericState,\n  PendingPatcher,\n  ChangedValueGroup,\n} from './types';\nimport Patcher from './Patcher';\nimport produce from 'state-tracker';\n\nclass Application<T, K extends keyof T> implements IApplication<T, K> {\n  public base: GenericState<T, K>;\n  public node: PathNode;\n  public pendingPatchers: Array<PendingPatcher>;\n  public namespace: string;\n  public strictMode: boolean;\n  public proxyState: any;\n\n  constructor({\n    base,\n    namespace,\n    strictMode,\n  }: {\n    base: GenericState<T, K>;\n    namespace: string;\n    strictMode: boolean;\n  }) {\n    this.base = base;\n    this.node = new PathNode();\n    this.pendingPatchers = [];\n    this.namespace = namespace;\n    this.strictMode = strictMode;\n    this.proxyState = produce(this.base);\n  }\n\n  update(values: Array<ChangedValueGroup<K>>) {\n    this.pendingPatchers = [];\n\n    // console.log('this node ', this.node)\n\n    try {\n      values.forEach(value => this.treeShake(value));\n      values.forEach(value => this.updateBase(value));\n    } catch (err) {\n      infoLog('[Application] update issue ', err);\n    }\n\n    // console.log('change value ', values, this.pendingPatchers.slice())\n\n    this.pendingPatchers.forEach(({ patcher }) => {\n      patcher.triggerAutoRun();\n    });\n  }\n\n  updateBase({\n    storeKey,\n    changedValue,\n  }: {\n    storeKey: K;\n    changedValue: object;\n  }) {\n    const origin = this.base[storeKey] || ({} as any);\n    this.proxyState.relink([storeKey], { ...origin, ...changedValue });\n  }\n\n  addPatchers(patchers: Array<Patcher>) {\n    // console.log('patchers ', patchers.slice())\n    if (patchers.length) {\n      patchers.forEach(patcher => {\n        this.pendingPatchers.push({ patcher });\n      });\n      patchers.forEach(patcher => {\n        patcher.markDirty();\n      });\n    }\n  }\n\n  /**\n   *\n   * Recently it only support `Array`, `Object`, `Number`, `String` and `Boolean` five\n   * types..\n   */\n  treeShake({ storeKey, changedValue }: { storeKey: K; changedValue: object }) {\n    const branch = this.node.children[storeKey as any];\n    const baseValue = this.base[storeKey];\n    const nextValue = { ...baseValue, ...changedValue };\n\n    // why it could be undefined. please refer to https://github.com/ryuever/relinx/issues/4\n    if (!branch) return;\n\n    const toDestroy: Array<Function> = [];\n    const compare = (\n      branch: PathNode,\n      baseValue: {\n        [key: string]: any;\n      },\n      nextValue: {\n        [key: string]: any;\n      }\n    ) => {\n      const keysToCompare = Object.keys(branch.children);\n\n      keysToCompare.forEach(key => {\n        const oldValue = baseValue[key];\n        const newValue = nextValue[key];\n\n        if (shallowEqual(oldValue, newValue)) return;\n\n        if (isTypeEqual(oldValue, newValue)) {\n          if (isPrimitive(newValue)) {\n            if (oldValue !== newValue) {\n              // console.log('add patcher ', oldValue, newValue, key)\n              this.addPatchers(branch.children[key].patchers);\n            }\n          }\n\n          if (isMutable(newValue)) {\n            const childBranch = branch.children[key];\n            compare(childBranch, oldValue, newValue);\n            return;\n          }\n\n          return;\n        }\n        this.addPatchers(branch.children[key].patchers);\n      });\n    };\n\n    compare(branch, baseValue, nextValue);\n    toDestroy.forEach(fn => fn());\n  }\n\n  addPatcher(patcher: Patcher) {\n    const paths = patcher.paths;\n\n    paths.forEach(fullPath => {\n      this.node.addPathNode(fullPath, patcher);\n    });\n  }\n\n  getStoreData(storeName: K): T[K] {\n    const storeValue = this.base[storeName];\n    return storeValue;\n  }\n}\n\nexport default Application;\n","// https://github.com/facebook/draft-js/blob/master/src/model/keys/generateRandomKey.js\n\ninterface SeenKeys {\n  [key: string]: boolean;\n}\n\ninterface PatcherIds {\n  [key: string]: number;\n}\n\ninterface PatcherSeenKeys {\n  [key: string]: {\n    [key: string]: number;\n  };\n}\n\nconst seenKeys: SeenKeys = {};\nconst MULTIPLIER = Math.pow(2, 24) // eslint-disable-line\n\nexport const generateNamespaceKey = () => {\n  let key;\n\n  while (key === undefined || seenKeys.hasOwnProperty(key) || !isNaN(+key)) { // eslint-disable-line\n    key = Math.floor(Math.random() * MULTIPLIER).toString(32);\n  }\n\n  seenKeys[key] = true;\n  return key;\n};\n\nconst patcherIds: PatcherIds = {};\nexport const generatePatcherId = ({\n  namespace,\n}: {\n  namespace: string;\n}): string => {\n  const count = patcherIds[namespace] || 0;\n  const next = count + 1;\n  patcherIds[namespace] = next;\n  return `${namespace}_patcherId_${count}`;\n};\n\nconst patcherSeenKeys: PatcherSeenKeys = {};\nexport const generatePatcherKey = ({\n  namespace,\n  componentName,\n}: {\n  namespace: string;\n  componentName: string;\n}) => {\n  if (!patcherSeenKeys[namespace]) patcherSeenKeys[namespace] = {};\n  const count = patcherSeenKeys[namespace][componentName] || 0;\n  const next = count + 1;\n  patcherSeenKeys[namespace][componentName] = next;\n  return `${namespace}_${componentName}_patcher_${count}`;\n};\n\nexport const generateRandomGlobalActionKey = () => Math.floor(Math.random() * MULTIPLIER).toString(32) // eslint-disable-line\n","import React, { useRef } from 'react';\nimport context, { defaultValue } from './context';\nimport Application from './Application';\nimport { generateNamespaceKey } from './utils/key';\nimport { ProviderProps, BasicModelType } from './types';\n\n// https://fettblog.eu/typescript-react/children/\n// https://stackoverflow.com/questions/53958028/how-to-use-generics-in-props-in-react-in-a-functional-component\nfunction Provider<T extends BasicModelType<T>, K extends keyof T = keyof T>({\n  store,\n  children,\n  namespace,\n  useProxy = true,\n  useRelinkMode = true,\n  strictMode = false,\n  useScope = true,\n}: ProviderProps<T>) {\n  const namespaceRef = useRef(namespace || generateNamespaceKey());\n  const application = useRef(\n    new Application<T, K>({\n      base: store.getState() as any,\n      namespace: namespaceRef.current,\n      strictMode,\n    })\n  );\n\n  store.bindApplication(application.current);\n  const dispatch = store.dispatch;\n\n  const contextValue = useRef({\n    ...defaultValue,\n    dispatch,\n    useProxy,\n    useScope,\n    useRelinkMode,\n    namespace: namespaceRef.current,\n    application: application.current,\n  });\n\n  return (\n    <context.Provider value={contextValue.current}>{children}</context.Provider>\n  );\n}\n\nexport default Provider;\n","// https://github.com/reduxjs/redux/blob/master/src/compose.ts\n\nexport default function compose(...funcs: Array<Function>) {\n  if (funcs.length === 0) {\n    return (arg: any) => arg;\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce((a, b) => (...args: Array<Function>) => a(b(...args)));\n}\n","import compose from './utils/compose';\nimport {\n  BasicModelType,\n  CreateStoreFn,\n  CreateStoreOnlyModels,\n  Middleware,\n  UnionActions,\n} from './types';\n\nexport default function applyMiddleware(...middleware: Array<Middleware>) {\n  const nextMiddleware = [...middleware];\n  return <T extends BasicModelType<T>>(\n    createStore: CreateStoreFn<T>\n  ) => (config: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in keyof T]?: any;\n    };\n  }) => {\n    const store = createStore(config);\n    const initialState = store.getState();\n\n    const api = {\n      dispatch: (actions: UnionActions, ...rest: Array<any>) =>\n        store.dispatch(actions, ...rest),\n      getState: () => initialState,\n      store,\n    };\n\n    const chain = nextMiddleware.map(middleware => middleware<T>(api));\n    store.decorateDispatch(compose(...chain));\n\n    return store;\n  };\n}\n","import Application from './Application';\nimport {\n  Action,\n  InternalDispatch,\n  Subscription,\n  BasicModelType,\n  ChangedValueGroup,\n  CreateStoreOnlyModels,\n  ExtractStateTypeOnlyModels,\n  ExtractEffectsTypeOnlyModels,\n  ExtractReducersTypeOnlyModels,\n} from './types';\n\nclass Store<T extends BasicModelType<T>, MODEL_KEY extends keyof T = keyof T> {\n  private _application: Application<T, MODEL_KEY> | null;\n  private _count: number;\n  public dispatch: InternalDispatch;\n  private _state: ExtractStateTypeOnlyModels<T>;\n  private _reducers: ExtractReducersTypeOnlyModels<T>;\n  private _effects: ExtractEffectsTypeOnlyModels<T>;\n  private _pendingActions: Array<Action>;\n  public initialState: any;\n  public subscriptions: {\n    [key: string]: Subscription<ExtractStateTypeOnlyModels<T>>;\n  };\n\n  constructor(configs: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in MODEL_KEY]?: any;\n    };\n  }) {\n    const models = configs.models;\n    const initialValue = configs.initialValue || ({} as any);\n\n    this._state = {} as ExtractStateTypeOnlyModels<T>;\n    this._reducers = {} as ExtractReducersTypeOnlyModels<T>;\n    this._effects = {} as ExtractEffectsTypeOnlyModels<T>;\n    this._pendingActions = [];\n\n    const keys = Object.keys(models) as Array<MODEL_KEY>;\n\n    keys.forEach(key => {\n      this.injectModel(key, models[key], initialValue[key]);\n    });\n\n    this.dispatch = () => {};\n    this._application = null;\n    this.subscriptions = {};\n    this._count = 0;\n  }\n\n  getState(): ExtractStateTypeOnlyModels<T> {\n    return this._state;\n  }\n\n  getReducers(): ExtractReducersTypeOnlyModels<T> {\n    return this._reducers;\n  }\n\n  getEffects(): ExtractEffectsTypeOnlyModels<T> {\n    return this._effects;\n  }\n\n  setValue(actions: Array<Action>) {\n    const nextActions = ([] as Array<Action>).concat(actions);\n    const changedValues = nextActions.reduce<\n      Array<ChangedValueGroup<MODEL_KEY>>\n    >((changedValueGroup, action) => {\n      if (!this._application) return [];\n      const { type, payload } = action;\n      const [storeKey, actionType] = type.split('/') as [\n        MODEL_KEY,\n        keyof ExtractReducersTypeOnlyModels<T>\n      ];\n      const usedReducer = this._reducers[storeKey];\n\n      // If usedReducer is null, Maybe you have dispatched an unregistered action.\n      // On this condition, put these actions to `this._pendingActions`\n      if (!usedReducer) {\n        this._pendingActions.push(action);\n      } else if (usedReducer[actionType]) {\n        const currentState = this._application.base[storeKey];\n        const changedValue = usedReducer[actionType](currentState, payload);\n        changedValueGroup.push({\n          storeKey,\n          changedValue,\n        });\n      } else {\n        console.warn(`Do not have action '${actionType}'`);\n      }\n\n      return changedValueGroup;\n    }, []);\n\n    if (changedValues.length) {\n      const toObject = changedValues.reduce<\n        {\n          [key in MODEL_KEY]: object;\n        }\n      >(\n        (acc, cur) => {\n          const { storeKey, changedValue } = cur;\n          acc[storeKey] = changedValue;\n          return acc;\n        },\n        {} as {\n          [key in MODEL_KEY]: object;\n        }\n      );\n      const oldState = {\n        ...this._application?.base,\n      } as ExtractStateTypeOnlyModels<T>;\n      const newState = {\n        ...this._application?.base,\n        ...toObject,\n      } as ExtractStateTypeOnlyModels<T>;\n\n      this._application?.update(changedValues);\n\n      for (let key in this.subscriptions) {\n        const subscription = this.subscriptions[key];\n        subscription({\n          oldState,\n          newState,\n          diff: toObject as Partial<ExtractStateTypeOnlyModels<T>>,\n        });\n      }\n    }\n  }\n\n  bindApplication(application: Application<T, MODEL_KEY>) {\n    this._application = application;\n  }\n\n  decorateDispatch(chainedMiddleware: Function) {\n    this.dispatch = chainedMiddleware(this.setValue.bind(this));\n  }\n\n  generateSubscriptionKey(): string {\n    return `store_${this._count++}`;\n  }\n\n  subscribe(\n    subscription: Subscription<ExtractStateTypeOnlyModels<T>>\n  ): Function {\n    const key = this.generateSubscriptionKey();\n    this.subscriptions[key] = subscription;\n    return () => delete this.subscriptions[key];\n  }\n\n  injectModel(key: MODEL_KEY, model: any, initialValue: any = {}) {\n    const { state, reducers = {}, effects = {} } = model;\n    // consume all the pending actions.\n    let base = this._application?.getStoreData(key) || {\n      ...state,\n      ...initialValue,\n    };\n\n    const nextPendingActions = this._pendingActions.filter(action => {\n      const { type, payload } = action;\n      const [storeKey, actionType] = type.split('/') as [\n        MODEL_KEY,\n        keyof ExtractReducersTypeOnlyModels<T>\n      ];\n\n      // only process action with current injected model's tag\n      if (key === storeKey) {\n        const reducer = reducers[actionType];\n        const effect = effects[actionType];\n\n        let nextState = base;\n\n        if (typeof reducer === 'function') {\n          nextState = reducer(base, payload);\n          base = { ...base, ...nextState };\n          // what if pending action is an effect. call dispatch again to re-run...\n          // But, there is still a condition, effects followed by normal reducer...\n          // The result may override by effect...\n        } else if (typeof effect === 'function') {\n          this.dispatch(action);\n        } else {\n          console.warn(\n            `Maybe you have dispatched an unregistered model's effect action(${action})`\n          );\n        }\n      }\n\n      return storeKey !== key;\n    });\n\n    this._state[key] = base;\n    this._pendingActions = nextPendingActions;\n\n    this._application?.updateBase({\n      storeKey: key,\n      changedValue: base,\n    });\n\n    if (reducers) this._reducers[key] = reducers as any;\n    if (effects) this._effects[key] = effects as any;\n  }\n}\n\nexport default Store;\n","import Store from './Store';\n\nimport {\n  CreateStoreOnlyModels,\n  EnhanceFunction,\n  BasicModelType,\n} from './types';\n\nexport default function createStore<\n  T extends BasicModelType<T>,\n  MODEL_KEY extends keyof T = keyof T\n>(\n  configs: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in MODEL_KEY]?: any;\n    };\n  },\n  enhancer?: EnhanceFunction\n): Store<T> {\n  if (typeof enhancer === 'function') {\n    return enhancer<T, MODEL_KEY>(createStore)(configs);\n  }\n\n  return new Store(configs);\n}\n","import { useContext } from 'react';\nimport context from '../context';\nimport {\n  RelinxDispatch,\n  UseRelinxReturnValue,\n  ContextDefaultValue,\n} from '../types';\n\nexport default <T, M, K extends keyof T = any>(\n  storeName: K\n): UseRelinxReturnValue<T, M, K> => {\n  const { dispatch, application, componentName } = useContext<\n    ContextDefaultValue<T, M>\n  >(context);\n\n  const proxyState = application?.proxyState;\n  const state = proxyState.peek([storeName]);\n  const tracker = state.getTracker();\n  tracker.setContext(componentName);\n\n  return [state, dispatch as RelinxDispatch<T, M>];\n};\n","import { useContext } from 'react';\nimport context from '../context';\nimport { ContextDefaultValue, RelinxDispatch } from '../types';\n\nexport default <T, M>(): [RelinxDispatch<T, M>] => {\n  const { dispatch } = useContext<ContextDefaultValue<T, M>>(context);\n  return [dispatch as RelinxDispatch<T, M>];\n};\n","import { useContext } from 'react';\nimport context from '../context';\n\nexport default (): string => {\n  const { namespace } = useContext(context);\n  return namespace!;\n};\n","import { Collections, Action } from './types';\n\nclass GlobalHelper {\n  public collections: Collections;\n  constructor() {\n    this.collections = [];\n  }\n\n  addAction(actionKey: string, namespace: string, actions: Array<Action>) {\n    this.collections.push({\n      actionKey,\n      namespace,\n      remover: () => {\n        const index = this.collections.findIndex(\n          ({ actionKey: key }) => key === actionKey\n        );\n        if (index !== -1) this.collections.splice(index, 1);\n      },\n      actions,\n    });\n  }\n}\n\nexport default new GlobalHelper();\n","import invariant from 'invariant';\nimport globalHelper from '../globalHelper';\nimport { generateRandomGlobalActionKey } from '../utils/key';\nimport {\n  GlobalActions,\n  GlobalAction,\n  GlobalDispatch,\n  Collections,\n} from '../types';\n\nconst dispatch = (actions: GlobalActions | GlobalAction) => {\n  const next = ([] as GlobalActions).concat(actions);\n\n  next.forEach(action => {\n    const { namespace: targetNamespace, actions } = action;\n    invariant(targetNamespace, '`namespace` is required for global action');\n    invariant(actions, '`actions` is required for global action');\n    const actionKey = generateRandomGlobalActionKey();\n    globalHelper.addAction(actionKey, targetNamespace, actions);\n  });\n};\n\n// It is not a official documentation compatible Hooks API.\n// For global state, data change responsive is not required, which means\n// value's change will not trigger any UI/data update...\nexport default (): [Collections, GlobalDispatch] => [\n  globalHelper.collections,\n  dispatch,\n];\n","import {\n  Next,\n  Action,\n  ThunkFn,\n  InternalDispatch,\n  ThunkDispatch,\n  BasicModelType,\n  ApplyMiddlewareAPI,\n  ExtractEffectsTypeOnlyModels,\n} from '../types';\n\n/**\n * The basic format of action type is `storeKey/${type}`.\n * Only action in effect could ignore `storeKey`\n */\nexport default <T extends BasicModelType<T>>({\n  getState,\n  dispatch,\n  store,\n}: ApplyMiddlewareAPI<T>) => (next: Next) => (\n  actions: Array<Action> | Function,\n  storeKey: keyof T\n) => {\n  if (typeof actions === 'function') {\n    const nextDispatch = (thunkActions: Array<Action> | Action) => {\n      const nextArgs = ([] as Array<Action>).concat(thunkActions) || [];\n      const actions = nextArgs\n        .map(action => {\n          if (!action) return null;\n          const { type, payload } = action;\n          const parts = [storeKey].concat(type.split('/') as any).slice(-2);\n          const nextAction: Action = {\n            type: parts.join('/'),\n          };\n          if (payload) {\n            nextAction.payload = payload;\n          }\n\n          return nextAction;\n        })\n        .filter(v => !!v) as Array<Action>;\n      if (actions.length) dispatch && (dispatch as InternalDispatch)(actions);\n    };\n    return actions(nextDispatch, getState);\n  }\n\n  const nextActions = ([] as Array<Action>).concat(actions);\n  const reducerActions: Array<Action> = [];\n  const effectActions: Array<Action> = [];\n\n  nextActions\n    .filter(action => {\n      if (Object.prototype.toString.call(action) === '[object Object]') {\n        const { type } = action;\n        return !!type;\n      }\n\n      return false;\n    })\n    .forEach(function(action: Action) {\n      try {\n        const { type } = action;\n        const parts = type.split('/');\n        const storeKey = parts[0] as keyof T;\n        const actionType = parts[1] as keyof ExtractEffectsTypeOnlyModels<\n          T\n        >[typeof storeKey];\n        const currentEffects = store.getEffects()[storeKey];\n\n        if (currentEffects && currentEffects[actionType]) {\n          return effectActions.push(action);\n        }\n\n        // If you dispatch an unregistered model's effect, it will be\n        // considered as an normal reducer action..\n        return reducerActions.push(action);\n      } catch (info) {\n        return false;\n      }\n    });\n\n  if (reducerActions.length) {\n    next(reducerActions);\n  }\n\n  effectActions.forEach(action => {\n    const { type, payload } = action;\n    const parts = type.split('/');\n    const storeKey = parts[0] as keyof T;\n    const actionType = parts[1] as keyof ExtractEffectsTypeOnlyModels<\n      T\n    >[keyof T];\n    const currentEffects = store.getEffects()[storeKey];\n    const handler = (currentEffects[actionType] as unknown) as ThunkFn<T>;\n\n    dispatch && (dispatch as ThunkDispatch<T>)(handler(payload), storeKey);\n  });\n};\n","const padding = (value: number, paddingCount = 2) =>\n  `00${value}`.slice(-paddingCount);\n\nexport const formatTime = (d: number) => {\n  const date = new Date(d);\n  const hh = date.getHours();\n  const mm = date.getMinutes();\n  const ss = date.getSeconds();\n  const ms = date.getMilliseconds();\n\n  return `${padding(hh)}:${padding(mm)}:${padding(ss)}.${padding(ms, 3)}`;\n};\n","import { Action } from '../../types';\n\nimport { formatTime } from './utils';\n\nconst colorLine = Function.apply.bind(console.log, null) // eslint-disable-line\nconst colorGroupEnd = console.groupEnd // eslint-disable-line\nconst colorGroupCollapsed = Function.apply.bind(console.groupCollapsed, null) // eslint-disable-line\n// const isEmptyObject = obj => !obj || Object.keys(obj).length === 0 && obj.constructor === Object\n\nconst colorLog = (group: Array<Array<string>>) => {\n  const { text: t, styles: s } = group.reduce(\n    (acc, cur) => {\n      const { text, styles } = acc;\n      const [subText, subStyle] = cur;\n\n      return {\n        text: `${text}%c ${subText}`,\n        styles: ([] as Array<string>).concat(styles, subStyle),\n      };\n    },\n    {\n      text: '',\n      styles: [] as Array<string>,\n    }\n  );\n\n  return [t, ...s];\n};\n\nconst renderTitle = (props: {\n  initialActions: Array<Action>;\n  startTime: number;\n  endTime: number;\n}) => {\n  const { initialActions, startTime, endTime } = props;\n  let title: string = '';\n\n  const nextActions = ([] as Array<Action>).concat(initialActions).slice(0, 2);\n\n  nextActions.forEach(({ type }) => {\n    title = title ? `${title}__${type}` : type;\n  });\n\n  if (initialActions.length > 2) {\n    title = `${title}...`;\n  }\n\n  let actionColor = 'color: #7cb305; font-weight: bold';\n\n  if (title.startsWith('@init')) {\n    actionColor = 'color: #ff4d4f; font-weight: bold';\n  }\n\n  const parts = [];\n  parts.push(['action', actionColor]);\n  parts.push([title, 'color: inherit;']);\n  parts.push([\n    `@ ${formatTime(startTime)}`,\n    'color: gray; font-weight: lighter;',\n  ]);\n  parts.push([\n    `(${endTime - startTime}ms)`,\n    'color: gray; font-weight: lighter;',\n  ]);\n\n  colorGroupCollapsed(colorLog(parts));\n};\n\nconst renderSubAction = (props: {\n  type: string;\n  payload?: any;\n  actionType?: string;\n  style?: string;\n}) => {\n  const { type, payload = '', actionType = 'action', style } = props;\n  const parts = [];\n\n  if (type) {\n    parts.push([actionType, 'color: #eb2f96; font-weight: bold']);\n    parts.push([type, 'color: #722ed1; font-weight: bold']);\n  }\n\n  if (style === 'line') {\n    colorLine([...colorLog(parts), payload]);\n  } else {\n    colorGroupCollapsed([...colorLog(parts), payload]);\n  }\n};\n\nconst renderState = (state: object, isNextState: boolean = false) => {\n  const parts = [];\n\n  let title = 'currentState';\n  let style = 'color: #4CAF50; font-weight: bold';\n\n  if (isNextState) {\n    title = 'nextState';\n    style = 'color: #4CAF50; font-weight: bold';\n  }\n\n  parts.push([title, style]);\n  colorLine([...colorLog(parts), state]);\n};\n\nconst renderPrevState = (state: object) => {\n  renderState(state);\n};\n\nconst paint = (tree: {\n  type: string;\n  actions?: {\n    [key: string]: any;\n  };\n  effects?: {\n    [key: string]: any;\n  };\n  payload?: any;\n  actionType?: string;\n}) => {\n  const { type, actions = {}, effects = {}, payload, actionType } = tree;\n  const actionKeys = Object.keys(actions);\n  const effectKeys = Object.keys(effects);\n\n  if (!actionKeys.length && !effectKeys.length) {\n    renderSubAction({\n      type,\n      payload,\n      actionType,\n      style: 'line',\n    });\n  } else {\n    renderSubAction({\n      type,\n      payload,\n      actionType,\n    });\n  }\n\n  actionKeys.forEach(key => {\n    const action = actions[key];\n    paint(action);\n  });\n  effectKeys.forEach(key => {\n    const effect = effects[key];\n    paint(effect);\n  });\n\n  if (actionKeys.length || effectKeys.length) {\n    colorGroupEnd();\n  }\n};\n\nconst paintActions = (actions: Array<Action>) => {\n  const nextActions = actions.filter(({ type }) => !type.startsWith('@init'));\n\n  nextActions.forEach(action => paint(action));\n\n  if (nextActions.length) {\n    colorGroupEnd();\n  }\n};\n\nexport default (props: {\n  actions: Array<Action>;\n  prevState: object;\n  initialActions: Array<Action>;\n  startTime: number;\n  endTime: number;\n}) => {\n  const { prevState = {}, actions } = props;\n\n  renderTitle(props);\n  renderPrevState(prevState);\n  paintActions(actions);\n  colorGroupEnd();\n};\n","import print from './print';\nimport { Next, Action, ApplyMiddlewareAPI, BasicModelType } from '../../types';\n\nexport default <T extends BasicModelType<T>>({\n  getState,\n}: ApplyMiddlewareAPI<T>) => (next: Next) => (\n  actions: Array<Action> | Function\n) => {\n  if (typeof actions !== 'function') {\n    const startTime = Date.now();\n    const prevState = JSON.parse(JSON.stringify(getState()));\n\n    next(actions);\n\n    const endTime = Date.now();\n\n    print({\n      actions,\n      prevState,\n      initialActions: actions,\n      startTime,\n      endTime,\n    });\n  }\n};\n\n// 结束的时间点。。。\n// 如果同步的reducers的话，最外层运行结束就是一个结点\n// 如果说是一个effect的话，这个时候会有很多的不确定性。或者同样是以外层结束作为一个结点；\n// 然后每一次有sub结束完就搞一次；最终的结论就是一个action可能会有多个的log\n","import { IPatcher } from './types';\n\nclass Patcher implements IPatcher {\n  public autoRunFn: Function;\n  public paths: Array<Array<string>>;\n  public removers: Array<Function>;\n  public dirty: boolean;\n  public id: string;\n  public displayName: string;\n  public parent: null | Patcher;\n  public children: Array<any>;\n\n  constructor({\n    paths,\n    autoRunFn,\n    key,\n    parent,\n    displayName,\n  }: {\n    paths: Array<Array<string>>;\n    autoRunFn: Function;\n    key: string;\n    parent: null | Patcher;\n    displayName: string;\n  }) {\n    this.autoRunFn = autoRunFn;\n    this.paths = paths;\n\n    this.removers = [];\n    this.dirty = false;\n    this.id = key;\n    this.displayName = displayName;\n    this.parent = parent;\n    this.children = [];\n\n    if (this.parent) {\n      this.parent.children.push(this);\n    }\n  }\n\n  destroyPatcher() {\n    this.teardown();\n    if (this.children.length) {\n      this.children.forEach(child => child.destroyPatcher());\n    }\n\n    if (this.parent) {\n      this.parent.removeChild(this);\n    }\n    this.parent = null;\n  }\n\n  appendTo(parent: null | Patcher) {\n    if (this.parent) {\n      this.parent.removeChild(this);\n    }\n\n    if (parent) {\n      this.parent = parent;\n\n      if (parent.children.indexOf(this) === -1) {\n        parent.children.push(this);\n      }\n    }\n  }\n\n  belongs(parent: null | Patcher): boolean {\n    if (!parent) return false;\n\n    if (this.parent) {\n      if (this.parent === parent) {\n        return true;\n      }\n      return this.parent.belongs(parent);\n    }\n\n    return false;\n  }\n\n  removeChild(child: Patcher) {\n    const index = this.children.indexOf(child);\n    if (index !== -1) this.children.splice(index, 1);\n  }\n\n  update({ paths }: { paths: Array<Array<string>> }) {\n    this.paths = paths;\n    this.dirty = false;\n    this.teardown();\n  }\n\n  addRemover(remover: Function) {\n    this.removers.push(remover);\n  }\n\n  // 将patcher从PathNode上删除\n  teardown() {\n    this.removers.forEach(remover => remover());\n    this.removers = [];\n  }\n\n  markDirty() {\n    this.teardown();\n  }\n\n  markDirtyAll() {\n    this.teardown();\n\n    // If parent is dirty, then its children should be all dirty...\n    if (this.children.length) {\n      this.children.forEach(child => child.markDirtyAll());\n    }\n  }\n\n  triggerAutoRun() {\n    if (typeof this.autoRunFn === 'function') this.autoRunFn();\n  }\n}\n\nexport default Patcher;\n","import React, {\n  useContext,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n  FC,\n} from 'react';\nimport context from './context';\nimport { generatePatcherKey } from './utils/key';\nimport Patcher from './Patcher';\n\nlet count = 0;\n\nconst Helper = ({ addListener }: { addListener: Function }) => {\n  addListener();\n  return null;\n};\n\nexport default (WrappedComponent: FC<any>) => {\n  function NextComponent(props: any) {\n    const shadowState = useRef(0);\n    // @ts-ignore\n    const [_, setState] = useState(0); // eslint-disable-line\n    const patcherUpdated = useRef(0);\n    const isMounted = useRef(false);\n\n    useEffect(() => {\n      isMounted.current = true;\n    });\n\n    const {\n      application,\n      useProxy,\n      useScope,\n      namespace,\n      patcher: parentPatcher,\n      useRelinkMode,\n      ...rest\n    } = useContext(context);\n\n    const incrementCount = useRef(count++)  // eslint-disable-line\n    const componentName = `${NextComponent.displayName}-${incrementCount.current}`;\n    const patcher = useRef<undefined | Patcher>();\n\n    shadowState.current += 1;\n\n    const autoRunFn = () => {\n      if (isMounted.current) setState(state => state + 1);\n    };\n\n    if (!patcher.current) {\n      patcher.current = new Patcher({\n        paths: [],\n        autoRunFn,\n        parent: parentPatcher,\n        key: generatePatcherKey({\n          namespace: namespace as string,\n          componentName,\n        }),\n        displayName: NextComponent.displayName,\n      });\n    }\n\n    application?.proxyState.enter(componentName);\n\n    useEffect(\n      () => () => {\n        if (patcher.current) patcher.current.destroyPatcher();\n      },\n      [] // eslint-disable-line\n    );\n\n    const addListener = useCallback(() => {\n      patcher.current?.appendTo(parentPatcher); // maybe not needs\n      // const paths = []\n      // const start = Date.now();\n      // const paths2 = application?.proxyState\n      //   .getContext()\n      //   .getCurrent()\n      //   .getRemarkable();\n      // const end = Date.now();\n      // console.log('diff ', componentName, end - start, paths2);\n\n      // @ts-ignore\n      const paths = application?.proxyState\n        .getContext()\n        .getCurrent()\n        .getRemarkable();\n      // const end2 = Date.now();\n      // console.log('diff ', componentName, end2 - end, paths);\n\n      patcher.current?.update({ paths });\n      if (patcher.current) application?.addPatcher(patcher.current);\n      patcherUpdated.current += 1;\n      application?.proxyState.leave(componentName);\n    }, []); // eslint-disable-line\n\n    const contextValue = {\n      ...rest,\n      application,\n      useProxy,\n      useScope,\n      namespace,\n      useRelinkMode,\n      patcher: patcher.current,\n      componentName: componentName,\n    };\n\n    return (\n      <context.Provider value={contextValue}>\n        <React.Fragment>\n          <WrappedComponent {...props} />\n          <Helper addListener={addListener} />\n        </React.Fragment>\n      </context.Provider>\n    );\n  }\n\n  NextComponent.displayName =\n    WrappedComponent.displayName ||\n    WrappedComponent.name ||\n    'ObservedComponent';\n\n  return React.memo(props => <NextComponent {...props} />);\n};\n"],"names":["calculateChangeBits","noop","defaultValue","computation","dispatch","attachStoreName","useProxy","namespace","patcher","trackerNode","useRelinkMode","application","createContext","infoLog","args","console","log","DEBUG","PathNode","constructor","prop","parent","children","patchers","addPathNode","path","len","length","reduce","node","cur","index","childNode","push","addRemover","indexOf","id","splice","err","destroyPathNode","forEach","destroyPatcher","childKeys","Object","keys","key","pathNode","toString","Function","call","bind","prototype","isObject","obj","isArray","isNumber","isString","isBoolean","isMutable","isPrimitive","isTypeEqual","o1","o2","hasOwnProperty","is","x","y","shallowEqual","objA","objB","keysA","keysB","i","Application","base","strictMode","pendingPatchers","proxyState","produce","update","values","value","treeShake","updateBase","triggerAutoRun","storeKey","changedValue","origin","relink","addPatchers","markDirty","branch","baseValue","nextValue","toDestroy","compare","keysToCompare","oldValue","newValue","childBranch","fn","addPatcher","paths","fullPath","getStoreData","storeName","storeValue","seenKeys","MULTIPLIER","Math","pow","generateNamespaceKey","undefined","isNaN","floor","random","patcherSeenKeys","generatePatcherKey","componentName","count","next","generateRandomGlobalActionKey","Provider","store","useScope","namespaceRef","useRef","getState","current","bindApplication","contextValue","React","context","compose","funcs","arg","a","b","applyMiddleware","middleware","nextMiddleware","createStore","config","initialState","api","actions","rest","chain","map","decorateDispatch","Store","configs","models","initialValue","_state","_reducers","_effects","_pendingActions","injectModel","_application","subscriptions","_count","getReducers","getEffects","setValue","nextActions","concat","changedValues","changedValueGroup","action","type","payload","actionType","split","usedReducer","currentState","warn","toObject","acc","oldState","newState","subscription","diff","chainedMiddleware","generateSubscriptionKey","subscribe","model","state","reducers","effects","nextPendingActions","filter","reducer","effect","nextState","enhancer","useContext","peek","tracker","getTracker","setContext","GlobalHelper","collections","addAction","actionKey","remover","findIndex","targetNamespace","invariant","globalHelper","nextDispatch","thunkActions","nextArgs","parts","slice","nextAction","join","v","reducerActions","effectActions","currentEffects","info","handler","padding","paddingCount","formatTime","d","date","Date","hh","getHours","mm","getMinutes","ss","getSeconds","ms","getMilliseconds","colorLine","apply","colorGroupEnd","groupEnd","colorGroupCollapsed","groupCollapsed","colorLog","group","text","t","styles","s","subText","subStyle","renderTitle","props","initialActions","startTime","endTime","title","actionColor","startsWith","renderSubAction","style","renderState","isNextState","renderPrevState","paint","tree","actionKeys","effectKeys","paintActions","prevState","now","JSON","parse","stringify","print","Patcher","autoRunFn","displayName","removers","dirty","teardown","child","removeChild","appendTo","belongs","markDirtyAll","Helper","addListener","WrappedComponent","NextComponent","shadowState","_","setState","useState","patcherUpdated","isMounted","useEffect","parentPatcher","incrementCount","enter","useCallback","getContext","getCurrent","getRemarkable","leave","Fragment","name","memo"],"mappings":"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"}