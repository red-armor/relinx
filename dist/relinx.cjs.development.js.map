{"version":3,"file":"relinx.cjs.development.js","sources":["../src/context.ts","../src/utils/infoLog.ts","../src/PathNode.ts","../src/utils/is.ts","../src/utils/toString.ts","../src/utils/ifType.ts","../src/utils/diffArraySimple.ts","../src/Application.ts","../src/utils/key.ts","../src/Provider.tsx","../src/utils/compose.ts","../src/applyMiddleware.ts","../src/Store.ts","../src/createStore.ts","../src/hooks/useRelinx.ts","../src/hooks/useDispatch.ts","../src/hooks/useNamespace.ts","../src/globalHelper.ts","../src/hooks/useGlobal.ts","../src/middleware/thunk.ts","../src/middleware/logger/utils.ts","../src/middleware/logger/print.ts","../src/middleware/logger/index.ts","../src/tracker/commons.ts","../src/tracker/context.ts","../src/tracker/path.ts","../src/tracker/internalFunctions.ts","../src/tracker/ES5Tracker.ts","../src/tracker/es5.ts","../src/tracker/types/commons.ts","../src/tracker/proxyTracker.ts","../src/tracker/proxy.ts","../src/tracker/TrackerNode.ts","../src/tracker/index.ts","../src/Patcher.ts","../src/observe.tsx"],"sourcesContent":["import { createContext } from 'react';\nimport { ContextDefaultValue } from './types';\n\nconst calculateChangeBits = () => 0b00;\nconst noop = () => {};\n\nexport const defaultValue: ContextDefaultValue = {\n  computation: null,\n  dispatch: noop,\n  attachStoreName: noop,\n  useProxy: true,\n  namespace: null,\n  patcher: null,\n  trackerNode: null,\n  useRelinkMode: true,\n  application: null,\n};\n\n// @ts-ignore\nexport default createContext<defaultValue>(defaultValue, calculateChangeBits);\n","/**\n * Intentional info-level logging for clear separation from ad-hoc console debug logging.\n */\nfunction infoLog(...args: Array<any>) {\n  console.log('**DEBUG**', ...args); // eslint-disable-line\n}\n\nexport default infoLog;\n","import infoLog from './utils/infoLog';\nimport Patcher from './Patcher';\n\nconst DEBUG = false;\n\ninterface Children {\n  [key: string]: PathNode;\n}\n\nclass PathNode {\n  private parent: PathNode | undefined;\n  public patchers: Array<Patcher>;\n  public children: Children;\n  private prop: string;\n\n  constructor(prop?: string, parent?: PathNode) {\n    this.prop = prop || 'root';\n\n    this.parent = parent;\n    this.children = {};\n    this.patchers = [];\n  }\n\n  addPathNode(path: Array<string>, patcher: Patcher) {\n    const len = path.length;\n    path.reduce<PathNode>((node: PathNode, cur: string, index: number) => {\n      // path中前面的值都是为了让我们定位到最后的需要关心的位置\n      if (!node.children[cur]) node.children[cur] = new PathNode(cur, node);\n      // 只有到达`path`的最后一个`prop`时，才会进行patcher的添加\n      if (index === len - 1) {\n        const childNode = node.children[cur];\n        if (DEBUG) {\n          infoLog('[PathNode add patcher]', childNode, patcher);\n        }\n        childNode.patchers.push(patcher);\n        patcher.addRemover(() => {\n          const index = childNode.patchers.indexOf(patcher);\n\n          if (DEBUG) {\n            infoLog('[PathNode remove patcher]', patcher.id, childNode);\n          }\n          if (index !== -1) {\n            childNode.patchers.splice(index, 1);\n          }\n        });\n      }\n      return node.children[cur];\n    }, this);\n  }\n\n  destroyPathNode() {\n    try {\n      this.patchers.forEach(patcher => patcher.destroyPatcher());\n\n      if (this.children) {\n        const childKeys = Object.keys(this.children);\n        childKeys.forEach(key => {\n          const pathNode = this.children[key];\n          pathNode.destroyPathNode();\n        });\n      }\n\n      if (this.parent) {\n        delete this.parent.children[this.prop];\n      }\n    } catch (err) {\n      infoLog('[PathNode destroy issue]', err);\n    }\n  }\n}\n\nexport default PathNode;\n","export default function is(x: any, y: any) {\n  // From: https://github.com/facebook/fbjs/blob/c69904a511b900266935168223063dd8772dfc40/packages/fbjs/src/core/shallowEqual.js\n  if (x === y) {\n    return x !== 0 || 1 / x === 1 / y;\n  }\n  return x !== x && y !== y // eslint-disable-line\n}\n","const toString = Function.call.bind(Object.prototype.toString);\n\nexport default toString;\n","import toString from './toString';\n\nexport const isPresent = (o: any) => typeof o !== 'undefined';\nexport const isObject = (obj: any) => toString(obj) === '[object Object]';\nexport const isArray = (obj: any) => toString(obj) === '[object Array]';\n\nexport const isMutable = (obj: any) => isObject(obj) || isArray(obj);\nexport const isTypeEqual = (o1: any, o2: any) => toString(o1) === toString(o2);\n\nexport const isStrictEmptyObject = (obj: any) => {\n  if (!isObject(obj)) return false;\n\n  for (const prop in obj) { // eslint-disable-line\n    if (obj.hasOwnProperty(prop)) return false // eslint-disable-line\n  }\n  return true;\n};\n\nexport const isStrictEmptyArray = (arr: any) => isArray(arr) && !arr.length;\n\nexport const hasEmptyItem = (...args: Array<any>) =>\n  args.some(arg => isStrictEmptyArray(arg) || isStrictEmptyObject(arg));\n","function diffArraySimple(\n  a: Array<string> = [] as any,\n  b: Array<string>\n): Array<string> {\n  const parts: Array<string> = [];\n\n  for (let i = 0; i < a.length; i++) {\n    const key = a[i];\n    if (b.indexOf(key) === -1) {\n      parts.push(key);\n    }\n  }\n\n  return parts;\n}\n\nexport default diffArraySimple;\n","import PathNode from './PathNode';\nimport is from './utils/is';\nimport infoLog from './utils/infoLog';\nimport { isObject, isMutable, isTypeEqual } from './utils/ifType';\nimport diffArraySimple from './utils/diffArraySimple';\nimport {\n  IApplication,\n  GenericState,\n  PendingPatcher,\n  ChangedValueGroup,\n  Operation,\n} from './types';\nimport Patcher from './Patcher';\n\nconst DEBUG = false;\nconst MINIMUS_RE_RENDER = false;\n\nclass Application<T, K extends keyof T> implements IApplication<T, K> {\n  public base: GenericState<T, K>;\n  public node: PathNode;\n  public pendingPatchers: Array<PendingPatcher>;\n  public namespace: string;\n  public strictMode: boolean;\n\n  constructor({\n    base,\n    namespace,\n    strictMode,\n  }: {\n    base: GenericState<T, K>;\n    namespace: string;\n    strictMode: boolean;\n  }) {\n    this.base = base;\n    this.node = new PathNode();\n    this.pendingPatchers = [];\n    this.namespace = namespace;\n    this.strictMode = strictMode;\n  }\n\n  update(values: Array<ChangedValueGroup<K>>) {\n    this.pendingPatchers = [];\n\n    if (DEBUG) {\n      infoLog('[Application] top most node ', this.node, this.base);\n      infoLog('[Application] changed value ', values);\n    }\n\n    try {\n      values.forEach(value => this.treeShake(value));\n      values.forEach(value => this.updateBase(value));\n    } catch (err) {\n      infoLog('[Application] update issue ', err);\n    }\n\n    const finalPatchers = [];\n    const len = this.pendingPatchers.length;\n\n    for (let i = 0; i < len; i++) {\n      const current = this.pendingPatchers[i].patcher;\n      const l = finalPatchers.length;\n      let found = false;\n      for (let y = 0; y < l; y++) {\n        // @ts-ignore\n        const base = finalPatchers[y];\n        if (current.belongs(base)) {\n          found = true;\n          break;\n        }\n        if (base.belongs(current)) {\n          finalPatchers.splice(y, 1);\n          finalPatchers.splice(y, 0, current);\n          found = true;\n          break;\n        }\n      }\n      if (!found) finalPatchers.push(current);\n    }\n\n    if (MINIMUS_RE_RENDER) {\n      finalPatchers.forEach(patcher => patcher.triggerAutoRun());\n    } else if (this.pendingPatchers.length) {\n      // const patcherId = generatePatcherId({ namespace: this.namespace });\n      this.pendingPatchers.forEach(({ patcher }) => {\n        patcher.triggerAutoRun();\n      });\n    }\n\n    if (DEBUG) {\n      if (MINIMUS_RE_RENDER) {\n        const final = finalPatchers.map(patcher => patcher.id);\n        infoLog('[Application] final patchers ', final, finalPatchers);\n      } else {\n        const pending = this.pendingPatchers.map(({ patcher }) => patcher.id);\n        infoLog(\n          '[Application] pending patchers ',\n          pending,\n          this.pendingPatchers\n        );\n      }\n    }\n  }\n\n  updateBase({\n    storeKey,\n    changedValue,\n  }: {\n    storeKey: K;\n    changedValue: object;\n  }) {\n    const origin = this.base[storeKey] || ({} as any);\n    this.base[storeKey] = { ...origin, ...changedValue };\n  }\n\n  treeShake({ storeKey, changedValue }: { storeKey: K; changedValue: object }) {\n    const branch = this.node.children[storeKey as any];\n    const baseValue = this.base[storeKey];\n    const rootBaseValue = baseValue;\n    const nextValue = { ...baseValue, ...changedValue };\n\n    // why it could be undefined. please refer to https://github.com/ryuever/relinx/issues/4\n    if (!branch) return;\n\n    const toDestroy: Array<Function> = [];\n    const compare = (\n      branch: PathNode,\n      baseValue: {\n        [key: string]: any;\n      },\n      nextValue: {\n        [key: string]: any;\n      },\n      collections: Array<string>,\n      operation: Array<Operation>\n    ) => {\n      if (is(baseValue, nextValue)) return;\n\n      // TODO, add description...only primitive type react...\n      if (!isTypeEqual(baseValue, nextValue) || !isMutable(nextValue)) {\n        if (branch.patchers.length) {\n          branch.patchers.forEach(patcher => {\n            this.pendingPatchers.push({ collections, patcher, operation });\n          });\n          // delete should be placed after collection...\n          // `branch.patchers` will be modified on `markDirty`..\n          // branch.patchers.forEach(patcher => patcher.markDirtyAll())\n          branch.patchers.forEach(patcher => patcher.markDirty());\n        }\n      }\n\n      const caredKeys = Object.keys(branch.children);\n      let keysToCompare = caredKeys;\n      let keysToDestroy: Array<string> = [];\n      const currentOperation: Array<Operation> = [];\n\n      // 处理，如果说array中的一项被删除了。。。。\n      if (isTypeEqual(baseValue, nextValue) && Array.isArray(nextValue)) {\n        const baseLength = (baseValue as any).length;\n        const nextLength = nextValue.length;\n\n        if (nextLength < baseLength) {\n          keysToCompare = caredKeys.filter(\n            key => parseInt(key, 10) < nextLength || key === 'length'\n          );\n          keysToDestroy = caredKeys.filter(key => {\n            if (parseInt(key, 10) >= nextLength) {\n              currentOperation.push({\n                path: collections.concat(key),\n                isDelete: true,\n              });\n              return true;\n            }\n            return false;\n          });\n        }\n      }\n\n      if (isObject(nextValue) && isObject(baseValue)) {\n        const nextKeys = Object.keys(nextValue);\n        const prevKeys = Object.keys(baseValue);\n        const removed = diffArraySimple(prevKeys, nextKeys);\n\n        if (removed.length) {\n          toDestroy.push(\n            ((branch: PathNode, removed: Array<string>) => {\n              removed.forEach(key => {\n                const childBranch = branch.children[key];\n                if (childBranch) childBranch.destroyPathNode();\n              });\n            }).bind(null, branch, removed)\n          );\n        }\n      }\n\n      if (this.strictMode) {\n        keysToCompare.forEach(key => {\n          const childBranch = branch.children[key];\n          if (!baseValue || typeof baseValue[key] === 'undefined') {\n            childBranch.patchers.forEach(patcher => {\n              const displayName = patcher.displayName;\n              const joinedPath = collections.concat(key).join('.');\n              console.warn('root base value ', rootBaseValue) // eslint-disable-line\n              console.warn( // eslint-disable-line\n                `Maybe you are using an un-declared props %c${joinedPath}` +\n                  ` %cin Component %c${displayName} %cYou'd better declare this prop in model first,` +\n                  'or component may not re-render when value changes on ES5.',\n                'color: #ff4d4f; font-weight: bold',\n                '',\n                'color: #7cb305; font-weight: bold',\n                ''\n              );\n            });\n          }\n        });\n      }\n\n      keysToCompare.forEach(key => {\n        const childBranch = branch.children[key];\n        const childBaseValue = baseValue ? baseValue[key] : undefined;\n        // 当一个对象中的key被删除的时候，那么它的值就是undefined\n        const childNextValue = nextValue ? nextValue[key] : undefined;\n\n        compare(\n          childBranch,\n          childBaseValue,\n          childNextValue,\n          collections.concat(key),\n          currentOperation\n        );\n      });\n\n      if (keysToDestroy.length) {\n        toDestroy.push(\n          ((branch: PathNode, keysToDestroy: Array<string>) => {\n            keysToDestroy.forEach(key => {\n              const childBranch = branch.children[key];\n              if (childBranch) childBranch.destroyPathNode();\n            });\n          }).bind(null, branch, keysToDestroy)\n        );\n      }\n    };\n\n    compare(branch, baseValue, nextValue, [storeKey as any], []);\n    toDestroy.forEach(fn => fn());\n  }\n\n  addPatcher(patcher: Patcher) {\n    const paths = patcher.paths;\n\n    paths.forEach(fullPath => {\n      this.node.addPathNode(fullPath, patcher);\n    });\n  }\n\n  getStoreData(storeName: K): T[K] {\n    const storeValue = this.base[storeName];\n\n    // on iOS 10. toString(new Proxy({}, {}) === 'object ProxyObject')\n    // invariant(\n    //   !!storeValue,\n    //   `Invalid storeName '${storeName}'.` +\n    //     'Please ensure `base[storeName]` return non-undefined value '\n    // );\n\n    return storeValue;\n  }\n}\n\nexport default Application;\n","// https://github.com/facebook/draft-js/blob/master/src/model/keys/generateRandomKey.js\n\ninterface SeenKeys {\n  [key: string]: boolean;\n}\n\ninterface PatcherIds {\n  [key: string]: number;\n}\n\ninterface PatcherSeenKeys {\n  [key: string]: {\n    [key: string]: number;\n  };\n}\n\nconst seenKeys: SeenKeys = {};\nconst MULTIPLIER = Math.pow(2, 24) // eslint-disable-line\n\nexport const generateNamespaceKey = () => {\n  let key;\n\n  while (key === undefined || seenKeys.hasOwnProperty(key) || !isNaN(+key)) { // eslint-disable-line\n    key = Math.floor(Math.random() * MULTIPLIER).toString(32);\n  }\n\n  seenKeys[key] = true;\n  return key;\n};\n\nconst patcherIds: PatcherIds = {};\nexport const generatePatcherId = ({\n  namespace,\n}: {\n  namespace: string;\n}): string => {\n  const count = patcherIds[namespace] || 0;\n  const next = count + 1;\n  patcherIds[namespace] = next;\n  return `${namespace}_patcherId_${count}`;\n};\n\nconst patcherSeenKeys: PatcherSeenKeys = {};\nexport const generatePatcherKey = ({\n  namespace,\n  componentName,\n}: {\n  namespace: string;\n  componentName: string;\n}) => {\n  if (!patcherSeenKeys[namespace]) patcherSeenKeys[namespace] = {};\n  const count = patcherSeenKeys[namespace][componentName] || 0;\n  const next = count + 1;\n  patcherSeenKeys[namespace][componentName] = next;\n  return `${namespace}_${componentName}_patcher_${count}`;\n};\n\nexport const generateRandomGlobalActionKey = () => Math.floor(Math.random() * MULTIPLIER).toString(32) // eslint-disable-line\n","import React, { useRef } from 'react';\nimport context, { defaultValue } from './context';\nimport Application from './Application';\nimport { generateNamespaceKey } from './utils/key';\nimport { ProviderProps, BasicModelType } from './types';\n\n// https://fettblog.eu/typescript-react/children/\n// https://stackoverflow.com/questions/53958028/how-to-use-generics-in-props-in-react-in-a-functional-component\nfunction Provider<T extends BasicModelType<T>, K extends keyof T = keyof T>({\n  store,\n  children,\n  namespace,\n  useProxy = true,\n  useRelinkMode = true,\n  strictMode = false,\n}: ProviderProps<T>) {\n  const namespaceRef = useRef(namespace || generateNamespaceKey());\n  const application = useRef(\n    new Application<T, K>({\n      base: store.getState() as any,\n      namespace: namespaceRef.current,\n      strictMode,\n    })\n  );\n\n  store.bindApplication(application.current);\n  const dispatch = store.dispatch;\n\n  const contextValue = useRef({\n    ...defaultValue,\n    dispatch,\n    useProxy,\n    useRelinkMode,\n    namespace: namespaceRef.current,\n    application: application.current,\n  });\n\n  return (\n    <context.Provider value={contextValue.current}>{children}</context.Provider>\n  );\n}\n\nexport default Provider;\n","// https://github.com/reduxjs/redux/blob/master/src/compose.ts\n\nexport default function compose(...funcs: Array<Function>) {\n  if (funcs.length === 0) {\n    return (arg: any) => arg;\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce((a, b) => (...args: Array<Function>) => a(b(...args)));\n}\n","import compose from './utils/compose';\nimport {\n  BasicModelType,\n  CreateStoreFn,\n  CreateStoreOnlyModels,\n  Middleware,\n  UnionActions,\n} from './types';\n\nexport default function applyMiddleware(...middleware: Array<Middleware>) {\n  const nextMiddleware = [...middleware];\n  return <T extends BasicModelType<T>>(\n    createStore: CreateStoreFn<T>\n  ) => (config: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in keyof T]?: any;\n    };\n  }) => {\n    const store = createStore(config);\n    const initialState = store.getState();\n\n    const api = {\n      dispatch: (actions: UnionActions, ...rest: Array<any>) =>\n        store.dispatch(actions, ...rest),\n      getState: () => initialState,\n      store,\n    };\n\n    const chain = nextMiddleware.map(middleware => middleware<T>(api));\n    store.decorateDispatch(compose(...chain));\n\n    return store;\n  };\n}\n","import Application from './Application';\nimport {\n  Action,\n  Dispatch,\n  Subscription,\n  BasicModelType,\n  ChangedValueGroup,\n  CreateStoreOnlyModels,\n  ExtractStateTypeOnlyModels,\n  ExtractEffectsTypeOnlyModels,\n  ExtractReducersTypeOnlyModels,\n} from './types';\n\nclass Store<T extends BasicModelType<T>, MODEL_KEY extends keyof T = keyof T> {\n  private _application: Application<T, MODEL_KEY> | null;\n  private _count: number;\n  public dispatch: Dispatch;\n  private _state: ExtractStateTypeOnlyModels<T>;\n  private _reducers: ExtractReducersTypeOnlyModels<T>;\n  private _effects: ExtractEffectsTypeOnlyModels<T>;\n  private _pendingActions: Array<Action>;\n  public initialState: any;\n  public subscriptions: {\n    [key: string]: Subscription<ExtractStateTypeOnlyModels<T>>;\n  };\n\n  constructor(configs: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in MODEL_KEY]?: any;\n    };\n  }) {\n    const models = configs.models;\n    const initialValue = configs.initialValue || ({} as any);\n\n    this._state = {} as ExtractStateTypeOnlyModels<T>;\n    this._reducers = {} as ExtractReducersTypeOnlyModels<T>;\n    this._effects = {} as ExtractEffectsTypeOnlyModels<T>;\n    this._pendingActions = [];\n\n    const keys = Object.keys(models) as Array<MODEL_KEY>;\n\n    keys.forEach(key => {\n      this.injectModel(key, models[key], initialValue[key]);\n    });\n\n    this.dispatch = () => {};\n    this._application = null;\n    this.subscriptions = {};\n    this._count = 0;\n  }\n\n  getState(): ExtractStateTypeOnlyModels<T> {\n    return this._state;\n  }\n\n  getReducers(): ExtractReducersTypeOnlyModels<T> {\n    return this._reducers;\n  }\n\n  getEffects(): ExtractEffectsTypeOnlyModels<T> {\n    return this._effects;\n  }\n\n  setValue(actions: Array<Action>) {\n    const nextActions = ([] as Array<Action>).concat(actions);\n    const changedValues = nextActions.reduce<\n      Array<ChangedValueGroup<MODEL_KEY>>\n    >((changedValueGroup, action) => {\n      if (!this._application) return [];\n      const { type, payload } = action;\n      const [storeKey, actionType] = type.split('/') as [\n        MODEL_KEY,\n        keyof ExtractReducersTypeOnlyModels<T>\n      ];\n      const usedReducer = this._reducers[storeKey];\n\n      // If usedReducer is null, Maybe you have dispatched an unregistered action.\n      // On this condition, put these actions to `this._pendingActions`\n      if (!usedReducer) {\n        this._pendingActions.push(action);\n      } else if (usedReducer[actionType]) {\n        const currentState = this._application.base[storeKey];\n        const changedValue = usedReducer[actionType](currentState, payload);\n        changedValueGroup.push({\n          storeKey,\n          changedValue,\n        });\n      } else {\n        console.warn(`Do not have action '${actionType}'`);\n      }\n\n      return changedValueGroup;\n    }, []);\n\n    if (changedValues.length) {\n      const toObject = changedValues.reduce<\n        {\n          [key in MODEL_KEY]: object;\n        }\n      >(\n        (acc, cur) => {\n          const { storeKey, changedValue } = cur;\n          acc[storeKey] = changedValue;\n          return acc;\n        },\n        {} as {\n          [key in MODEL_KEY]: object;\n        }\n      );\n      const oldState = {\n        ...this._application?.base,\n      } as ExtractStateTypeOnlyModels<T>;\n      const newState = {\n        ...this._application?.base,\n        ...toObject,\n      } as ExtractStateTypeOnlyModels<T>;\n\n      this._application?.update(changedValues);\n\n      for (let key in this.subscriptions) {\n        const subscription = this.subscriptions[key];\n        subscription({\n          oldState,\n          newState,\n          diff: toObject as Partial<ExtractStateTypeOnlyModels<T>>,\n        });\n      }\n    }\n  }\n\n  bindApplication(application: Application<T, MODEL_KEY>) {\n    this._application = application;\n  }\n\n  decorateDispatch(chainedMiddleware: Function) {\n    this.dispatch = chainedMiddleware(this.setValue.bind(this));\n  }\n\n  generateSubscriptionKey(): string {\n    return `store_${this._count++}`;\n  }\n\n  subscribe(\n    subscription: Subscription<ExtractStateTypeOnlyModels<T>>\n  ): Function {\n    const key = this.generateSubscriptionKey();\n    this.subscriptions[key] = subscription;\n    return () => delete this.subscriptions[key];\n  }\n\n  injectModel(key: MODEL_KEY, model: any, initialValue: any = {}) {\n    const { state, reducers = {}, effects = {} } = model;\n\n    // consume all the pending actions.\n    let base = this._application?.getStoreData(key) || {\n      ...state,\n      ...initialValue,\n    };\n\n    const nextPendingActions = this._pendingActions.filter(action => {\n      const { type, payload } = action;\n      const [storeKey, actionType] = type.split('/') as [\n        MODEL_KEY,\n        keyof ExtractReducersTypeOnlyModels<T>\n      ];\n\n      const reducer = reducers[actionType];\n      const effect = effects[actionType];\n\n      let nextState = base;\n\n      if (typeof reducer === 'function') {\n        nextState = reducer(base, payload);\n        base = { ...base, ...nextState };\n        // what if pending action is an effect. call dispatch again to re-run...\n        // But, there is still a condition, effects followed by normal reducer...\n        // The result may override by effect...\n      } else if (typeof effect === 'function') {\n        this.dispatch(action);\n      } else {\n        console.warn(\n          `Maybe you have dispatched an unregistered model's effect action(${action})`\n        );\n      }\n\n      return storeKey !== key;\n    });\n\n    this._state[key] = base;\n    this._pendingActions = nextPendingActions;\n    this._application?.updateBase({\n      storeKey: key,\n      changedValue: base,\n    });\n\n    if (reducers) this._reducers[key] = reducers as any;\n    if (effects) this._effects[key] = effects as any;\n  }\n}\n\nexport default Store;\n","import Store from './Store';\n\nimport {\n  CreateStoreOnlyModels,\n  EnhanceFunction,\n  BasicModelType,\n} from './types';\n\nexport default function createStore<\n  T extends BasicModelType<T>,\n  MODEL_KEY extends keyof T = keyof T\n>(\n  configs: {\n    models: CreateStoreOnlyModels<T>;\n    initialValue?: {\n      [key in MODEL_KEY]?: any;\n    };\n  },\n  enhancer?: EnhanceFunction\n): Store<T> {\n  if (typeof enhancer === 'function') {\n    return enhancer<T, MODEL_KEY>(createStore)(configs);\n  }\n\n  return new Store(configs);\n}\n","import { useContext } from 'react';\nimport invariant from 'invariant';\nimport context from '../context';\nimport { UseRelinxReturnValue } from '../types';\n\nexport default (storeName: string): UseRelinxReturnValue => {\n  const { dispatch, getData, attachStoreName } = useContext(context);\n\n  invariant(\n    typeof storeName === 'string' && storeName !== '',\n    '`storeName` is required'\n  );\n\n  invariant(!!getData, `'useRelinx' should be wrapper in observe function`);\n\n  attachStoreName(storeName);\n\n  const { trackerNode } = getData();\n\n  invariant(!!trackerNode.proxy, `[useRelinx]: 'getData' fails`);\n\n  return [trackerNode.proxy, dispatch];\n};\n","import { useContext } from 'react';\nimport context from '../context';\n\nexport default () => {\n  const { dispatch } = useContext(context);\n  return [dispatch];\n};\n","import { useContext } from 'react';\nimport context from '../context';\n\nexport default (): string => {\n  const { namespace } = useContext(context);\n  return namespace;\n};\n","import { Collections, Action } from './types';\n\nclass GlobalHelper {\n  public collections: Collections;\n  constructor() {\n    this.collections = [];\n  }\n\n  addAction(actionKey: string, namespace: string, actions: Array<Action>) {\n    this.collections.push({\n      actionKey,\n      namespace,\n      remover: () => {\n        const index = this.collections.findIndex(\n          ({ actionKey: key }) => key === actionKey\n        );\n        if (index !== -1) this.collections.splice(index, 1);\n      },\n      actions,\n    });\n  }\n}\n\nexport default new GlobalHelper();\n","import invariant from 'invariant';\nimport globalHelper from '../globalHelper';\nimport { generateRandomGlobalActionKey } from '../utils/key';\nimport {\n  GlobalActions,\n  GlobalAction,\n  GlobalDispatch,\n  Collections,\n} from '../types';\n\nconst dispatch = (actions: GlobalActions | GlobalAction) => {\n  const next = ([] as GlobalActions).concat(actions);\n\n  next.forEach(action => {\n    const { namespace: targetNamespace, actions } = action;\n    invariant(targetNamespace, '`namespace` is required for global action');\n    invariant(actions, '`actions` is required for global action');\n    const actionKey = generateRandomGlobalActionKey();\n    globalHelper.addAction(actionKey, targetNamespace, actions);\n  });\n};\n\n// It is not a official documentation compatible Hooks API.\n// For global state, data change responsive is not required, which means\n// value's change will not trigger any UI/data update...\nexport default (): [Collections, GlobalDispatch] => [\n  globalHelper.collections,\n  dispatch,\n];\n","import {\n  Next,\n  Action,\n  ThunkFn,\n  Dispatch,\n  ThunkDispatch,\n  BasicModelType,\n  ApplyMiddlewareAPI,\n  ExtractEffectsTypeOnlyModels,\n} from '../types';\n\n/**\n * The basic format of action type is `storeKey/${type}`.\n * Only action in effect could ignore `storeKey`\n */\nexport default <T extends BasicModelType<T>>({\n  getState,\n  dispatch,\n  store,\n}: ApplyMiddlewareAPI<T>) => (next: Next) => (\n  actions: Array<Action> | Function,\n  storeKey: keyof T\n) => {\n  if (typeof actions === 'function') {\n    const nextDispatch = (thunkActions: Array<Action> | Action) => {\n      const nextArgs = ([] as Array<Action>).concat(thunkActions) || [];\n      const actions = nextArgs\n        .map(action => {\n          if (!action) return null;\n          const { type, payload } = action;\n          const parts = [storeKey].concat(type.split('/') as any).slice(-2);\n          const nextAction: Action = {\n            type: parts.join('/'),\n          };\n          if (payload) {\n            nextAction.payload = payload;\n          }\n\n          return nextAction;\n        })\n        .filter(v => !!v) as Array<Action>;\n      if (actions.length) dispatch && (dispatch as Dispatch)(actions);\n    };\n    return actions(nextDispatch, getState);\n  }\n\n  const nextActions = ([] as Array<Action>).concat(actions);\n  const reducerActions: Array<Action> = [];\n  const effectActions: Array<Action> = [];\n\n  nextActions\n    .filter(action => {\n      if (Object.prototype.toString.call(action) === '[object Object]') {\n        const { type } = action;\n        return !!type;\n      }\n\n      return false;\n    })\n    .forEach(function(action: Action) {\n      try {\n        const { type } = action;\n        const parts = type.split('/');\n        const storeKey = parts[0] as keyof T;\n        const actionType = parts[1] as keyof ExtractEffectsTypeOnlyModels<\n          T\n        >[typeof storeKey];\n        const currentEffects = store.getEffects()[storeKey];\n\n        if (currentEffects && currentEffects[actionType]) {\n          return effectActions.push(action);\n        }\n\n        // If you dispatch an unregistered model's effect, it will be\n        // considered as an normal reducer action..\n        return reducerActions.push(action);\n      } catch (info) {\n        return false;\n      }\n    });\n\n  if (reducerActions.length) {\n    next(reducerActions);\n  }\n\n  effectActions.forEach(action => {\n    const { type, payload } = action;\n    const parts = type.split('/');\n    const storeKey = parts[0] as keyof T;\n    const actionType = parts[1] as keyof ExtractEffectsTypeOnlyModels<\n      T\n    >[keyof T];\n    const currentEffects = store.getEffects()[storeKey];\n    const handler = (currentEffects[actionType] as unknown) as ThunkFn<T>;\n\n    dispatch && (dispatch as ThunkDispatch<T>)(handler(payload), storeKey);\n  });\n};\n","const padding = (value: number, paddingCount = 2) =>\n  `00${value}`.slice(-paddingCount);\n\nexport const formatTime = (d: number) => {\n  const date = new Date(d);\n  const hh = date.getHours();\n  const mm = date.getMinutes();\n  const ss = date.getSeconds();\n  const ms = date.getMilliseconds();\n\n  return `${padding(hh)}:${padding(mm)}:${padding(ss)}.${padding(ms, 3)}`;\n};\n","import { Action } from '../../types';\n\nimport { formatTime } from './utils';\n\nconst colorLine = Function.apply.bind(console.log, null) // eslint-disable-line\nconst colorGroupEnd = console.groupEnd // eslint-disable-line\nconst colorGroupCollapsed = Function.apply.bind(console.groupCollapsed, null) // eslint-disable-line\n// const isEmptyObject = obj => !obj || Object.keys(obj).length === 0 && obj.constructor === Object\n\nconst colorLog = (group: Array<Array<string>>) => {\n  const { text: t, styles: s } = group.reduce(\n    (acc, cur) => {\n      const { text, styles } = acc;\n      const [subText, subStyle] = cur;\n\n      return {\n        text: `${text}%c ${subText}`,\n        styles: ([] as Array<string>).concat(styles, subStyle),\n      };\n    },\n    {\n      text: '',\n      styles: [] as Array<string>,\n    }\n  );\n\n  return [t, ...s];\n};\n\nconst renderTitle = (props: {\n  initialActions: Array<Action>;\n  startTime: number;\n  endTime: number;\n}) => {\n  const { initialActions, startTime, endTime } = props;\n  let title: string = '';\n\n  const nextActions = ([] as Array<Action>).concat(initialActions).slice(0, 2);\n\n  nextActions.forEach(({ type }) => {\n    title = title ? `${title}__${type}` : type;\n  });\n\n  if (initialActions.length > 2) {\n    title = `${title}...`;\n  }\n\n  let actionColor = 'color: #7cb305; font-weight: bold';\n\n  if (title.startsWith('@init')) {\n    actionColor = 'color: #ff4d4f; font-weight: bold';\n  }\n\n  const parts = [];\n  parts.push(['action', actionColor]);\n  parts.push([title, 'color: inherit;']);\n  parts.push([\n    `@ ${formatTime(startTime)}`,\n    'color: gray; font-weight: lighter;',\n  ]);\n  parts.push([\n    `(${endTime - startTime}ms)`,\n    'color: gray; font-weight: lighter;',\n  ]);\n\n  colorGroupCollapsed(colorLog(parts));\n};\n\nconst renderSubAction = (props: {\n  type: string;\n  payload?: any;\n  actionType?: string;\n  style?: string;\n}) => {\n  const { type, payload = '', actionType = 'action', style } = props;\n  const parts = [];\n\n  if (type) {\n    parts.push([actionType, 'color: #eb2f96; font-weight: bold']);\n    parts.push([type, 'color: #722ed1; font-weight: bold']);\n  }\n\n  if (style === 'line') {\n    colorLine([...colorLog(parts), payload]);\n  } else {\n    colorGroupCollapsed([...colorLog(parts), payload]);\n  }\n};\n\nconst renderState = (state: object, isNextState: boolean = false) => {\n  const parts = [];\n\n  let title = 'currentState';\n  let style = 'color: #4CAF50; font-weight: bold';\n\n  if (isNextState) {\n    title = 'nextState';\n    style = 'color: #4CAF50; font-weight: bold';\n  }\n\n  parts.push([title, style]);\n  colorLine([...colorLog(parts), state]);\n};\n\nconst renderPrevState = (state: object) => {\n  renderState(state);\n};\n\nconst paint = (tree: {\n  type: string;\n  actions?: {\n    [key: string]: any;\n  };\n  effects?: {\n    [key: string]: any;\n  };\n  payload?: any;\n  actionType?: string;\n}) => {\n  const { type, actions = {}, effects = {}, payload, actionType } = tree;\n  const actionKeys = Object.keys(actions);\n  const effectKeys = Object.keys(effects);\n\n  if (!actionKeys.length && !effectKeys.length) {\n    renderSubAction({\n      type,\n      payload,\n      actionType,\n      style: 'line',\n    });\n  } else {\n    renderSubAction({\n      type,\n      payload,\n      actionType,\n    });\n  }\n\n  actionKeys.forEach(key => {\n    const action = actions[key];\n    paint(action);\n  });\n  effectKeys.forEach(key => {\n    const effect = effects[key];\n    paint(effect);\n  });\n\n  if (actionKeys.length || effectKeys.length) {\n    colorGroupEnd();\n  }\n};\n\nconst paintActions = (actions: Array<Action>) => {\n  const nextActions = actions.filter(({ type }) => !type.startsWith('@init'));\n\n  nextActions.forEach(action => paint(action));\n\n  if (nextActions.length) {\n    colorGroupEnd();\n  }\n};\n\nexport default (props: {\n  actions: Array<Action>;\n  prevState: object;\n  initialActions: Array<Action>;\n  startTime: number;\n  endTime: number;\n}) => {\n  const { prevState = {}, actions } = props;\n\n  renderTitle(props);\n  renderPrevState(prevState);\n  paintActions(actions);\n  colorGroupEnd();\n};\n","import print from './print';\nimport { Next, Action, ApplyMiddlewareAPI, BasicModelType } from '../../types';\n\nexport default <T extends BasicModelType<T>>({\n  getState,\n}: ApplyMiddlewareAPI<T>) => (next: Next) => (\n  actions: Array<Action> | Function\n) => {\n  if (typeof actions !== 'function') {\n    const startTime = Date.now();\n    const prevState = JSON.parse(JSON.stringify(getState()));\n\n    next(actions);\n\n    const endTime = Date.now();\n\n    print({\n      actions,\n      prevState,\n      initialActions: actions,\n      startTime,\n      endTime,\n    });\n  }\n};\n\n// 结束的时间点。。。\n// 如果同步的reducers的话，最外层运行结束就是一个结点\n// 如果说是一个effect的话，这个时候会有很多的不确定性。或者同样是以外层结束作为一个结点；\n// 然后每一次有sub结束完就搞一次；最终的结论就是一个action可能会有多个的log\n","const toString = Function.call.bind<Function>(Object.prototype.toString);\nconst ownKeys = (o: any) =>\n  typeof Reflect !== 'undefined' && Reflect.ownKeys\n    ? Reflect.ownKeys(o)\n    : typeof Object.getOwnPropertySymbols !== 'undefined'\n    ? Object.getOwnPropertyNames(o).concat(\n        Object.getOwnPropertySymbols(o) as any\n      )\n    : Object.getOwnPropertyNames(o);\n\nexport const emptyFunction = () => {};\nexport const isObject = (o: any) => o ? (typeof o === 'object' || typeof o === 'function') : false // eslint-disable-line\nexport const hasSymbol = typeof Symbol !== 'undefined';\nexport const TRACKER: unique symbol = hasSymbol\n  ? Symbol('tracker')\n  : ('__tracker__' as any);\n\nexport const canIUseProxy = () => {\n  try {\n    new Proxy({}, {}) // eslint-disable-line\n  } catch (err) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const hasOwnProperty = (o: object, prop: PropertyKey) => o.hasOwnProperty(prop) // eslint-disable-line\n\nexport const isTrackable = (o: any) => { // eslint-disable-line\n  return ['[object Object]', '[object Array]'].indexOf(toString(o)) !== -1;\n};\n\ntype EachArray<T> = (index: number, entry: any, obj: T) => void;\ntype EachObject<T> = <K extends keyof T>(key: K, entry: T[K], obj: T) => number;\n\n// type EachObject = Array<any> | { [key: string]: any }\ntype Iter<T extends Array<any> | { [key: string]: any }> = T extends Array<any>\n  ? EachArray<T>\n  : T extends { [key: string]: any }\n  ? EachObject<T>\n  : never;\n\nexport function each<T>(obj: T, iter: Iter<T>) {\n  if (Array.isArray(obj)) {\n    (obj as Array<any>).forEach((entry, index) =>\n      (iter as EachArray<T>)(index, entry, obj)\n    );\n  } else if (isObject(obj)) {\n    // @ts-ignore\n    ownKeys(obj).forEach(key => (iter as EachObject<T>)(key, obj[key], obj));\n  }\n}\n\nexport const Type = {\n  Object: 'object',\n  Array: 'array',\n};\n\nexport function shallowCopy(o: any) {\n  if (Array.isArray(o)) return o.slice();\n  const value = Object.create(Object.getPrototypeOf(o));\n  ownKeys(o).forEach(key => {\n    value[key] = o[key];\n  });\n\n  return value;\n}\n\nexport const inherit = (\n  subClass: {\n    prototype: any;\n    // __proto__: any;\n  },\n  superClass: {\n    prototype: any;\n  }\n) => {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  // subClass.__proto__ = superClass // eslint-disable-line\n};\n\nexport const createHiddenProperty = (\n  target: object,\n  prop: PropertyKey,\n  value: any\n) => {\n  Object.defineProperty(target, prop, {\n    value,\n    enumerable: false,\n    writable: true,\n  });\n};\n\nexport const hideProperty = (target: object, prop: PropertyKey) => {\n  Object.defineProperty(target, prop, {\n    enumerable: false,\n    configurable: false,\n  });\n};\n","import { TrackerNode } from './types';\n\nconst context: {\n  trackerNode: null | TrackerNode;\n} = {\n  trackerNode: null,\n};\n\nexport default context;\n","const joinPath = (path: Array<string>) => path.join('_');\n\ninterface AccessMap {\n  [key: string]: number;\n}\n\nexport const generateRemarkablePaths = (paths: Array<Array<string>>) => {\n  const copy = paths.slice();\n  const accessMap: AccessMap = {};\n  const len = copy.length;\n  const remarkablePaths = [];\n\n  for (let i = len - 1; i >= 0; i--) {\n    const path = copy[i].slice();\n    const pathLength = path.length;\n\n    let isConsecutive = false;\n\n    for (let i = 0; i < pathLength; i++) {\n      const joinedPath = joinPath(path);\n      const count = accessMap[joinedPath] || 0;\n\n      // the intermediate accessed path will be ignored.\n      // https://stackoverflow.com/questions/2937120/how-to-get-javascript-object-references-or-reference-count\n      // because of this, intermediate value may be ignored...\n      if (isConsecutive) {\n        accessMap[joinedPath] = count + 1;\n        path.pop();\n        continue // eslint-disable-line\n      }\n\n      if (!count) {\n        const p = path.slice();\n        const str = joinPath(p);\n        const found = remarkablePaths.find(path => joinPath(path) === str);\n        if (!found) remarkablePaths.push(p);\n        isConsecutive = true;\n        path.pop();\n      } else {\n        accessMap[joinedPath] = count - 1;\n        break;\n      }\n    }\n  }\n\n  return remarkablePaths;\n};\n","import invariant from 'invariant';\nimport { isTrackable, hideProperty } from './commons';\nimport { generateRemarkablePaths } from './path';\nimport context from './context';\nimport { IProxyTracker, IES5Tracker, PropProperty } from './types';\n\nconst peek = (proxy: IProxyTracker | IES5Tracker, accessPath: Array<string>) => { // eslint-disable-line\n  return accessPath.reduce((proxy, cur: string) => {\n    proxy.setProp('isPeeking', true);\n    const nextProxy = proxy[cur];\n    proxy.setProp('isPeeking', false);\n    return nextProxy;\n  }, proxy);\n};\n\nfunction internalFunctions() {}\nconst proto = internalFunctions.prototype;\n\nproto.assertLink = function(fnName: string) {\n  const proxy = this;\n  const trackerNode = proxy.getProp('trackerNode');\n\n  invariant(\n    trackerNode,\n    `You should not use \\`${fnName}\\` method with pure \\`proxy\\` object.\\n` +\n      'which should be bind with an `trackerNode` object'\n  );\n\n  invariant(\n    context.trackerNode !== trackerNode,\n    `\\`${fnName}\\` method is used to update \\`proxy\\` object from upstream.\\n` +\n      'So it is not meaning to link proxy in current trackerNode scope'\n  );\n};\n\nproto.reportAccessPath = function(path: string) {\n  const proxy = this // eslint-disable-line\n  const paths = proxy.getProp('paths');\n  const parentProxy = proxy.getProp('parentProxy');\n  paths.push(path);\n  if (!parentProxy) return;\n  parentProxy.runFn('reportAccessPath', path);\n};\n\nproto.cleanup = function() {\n  const proxy = this // eslint-disable-line\n  proxy.setProp('paths', []);\n  proxy.setProp('propProperties', []);\n};\n\nproto.unlink = function() {\n  const proxy = this // eslint-disable-line\n  return proxy.getProp('base');\n};\n\nproto.relink = function(path: Array<string>, baseValue: object) {\n  try {\n    this.runFn('assertLink', 'relink');\n    const proxy = this // eslint-disable-line\n    let copy = path.slice();\n    let last = copy.pop();\n    const len = path.length;\n    let nextBaseValue: {\n      [key: string]: any;\n    } = baseValue;\n\n    // fix: {a: { b: 1 }} => {a: {}}, nextBaseValue[key] is undefined\n    for (let i = 0; i < len; i++) {\n      const key = path[i];\n      if (typeof nextBaseValue[key] !== 'undefined') {\n        nextBaseValue = nextBaseValue[key];\n      } else {\n        copy = path.slice(0, i - 1);\n        last = path[i - 1];\n        break;\n      }\n    }\n    const nextProxy = peek(proxy, copy);\n    nextProxy.relinkProp(last, nextBaseValue);\n  } catch (err) {\n    // infoLog('[proxy relink issue]', path, baseValue, err)\n  }\n};\n\nproto.relinkProp = function(prop: string, newValue: object) {\n  this.runFn('assertLink', 'relinkProp');\n  const proxy = this // eslint-disable-line\n  const base = proxy.getProp('base');\n  const childProxies = proxy.getProp('childProxies');\n  const accessPath = proxy.getProp('accessPath');\n\n  if (Array.isArray(base)) {\n    proxy.setProp(\n      'base',\n      base.filter(v => v)\n    );\n  }\n  proxy.getProp('base')[prop] = newValue;\n\n  if (isTrackable(newValue)) {\n    childProxies[prop] = proxy.createChild(newValue, {\n      accessPath: accessPath.concat(prop),\n      parentProxy: proxy,\n    });\n  }\n};\n\nproto.relinkBase = function(baseValue: object) {\n  this.runFn('assertLink', 'rebase');\n  this.runFn('rebase', baseValue);\n};\n\nproto.rebase = function(baseValue: object) {\n  try {\n    const proxy = this // eslint-disable-line\n    proxy.setProp('base', baseValue);\n  } catch (err) {\n    // infoLog('[proxy] rebase ', err)\n  }\n};\n\nproto.setRemarkable = function(): boolean {\n  const proxy = this // eslint-disable-line\n  const accessPath = proxy.getProp('accessPath');\n  const parentProxy = proxy.getProp('parentProxy');\n  if (!parentProxy) return false;\n  parentProxy.runFn('reportAccessPath', accessPath);\n  return true;\n};\n\nproto.getRemarkableFullPaths = function() {\n  const proxy = this // eslint-disable-line\n  const paths = proxy.getProp('paths');\n  const propProperties = proxy.getProp('propProperties');\n  const rootPath = proxy.getProp('rootPath');\n  const internalPaths = generateRemarkablePaths(paths).map(path =>\n    rootPath.concat(path)\n  );\n  const external = propProperties.map((prop: PropProperty) => {\n    const { path, source } = prop;\n    const sourceRootPath = source?.getProp('rootPath');\n    return sourceRootPath.concat(path);\n  });\n  const externalPaths = generateRemarkablePaths(external);\n  return internalPaths.concat(externalPaths);\n};\n\nproto.assertScope = function() {\n  const useScope = this.getProp('useScope');\n\n  if (!useScope) return;\n  const trackerNode = this.getProp('trackerNode');\n\n  // If `contextTrackerNode` is null, it means access top most data prop.\n  if (!trackerNode) {\n    console.warn(\n      'trackerNode is undefined, which means you are using createTracker function directly.' +\n        'Maybe you should create TrackerNode object.'\n    );\n  } else if (!trackerNode.contains(context.trackerNode) && context.trackerNode)\n    throw new Error(\n      trackerNode.id +\n        'is not child node of ' +\n        context.trackerNode.id +\n        'Property only could be accessed by self node or parent node.'\n    );\n};\n\nhideProperty(proto, 'assertLink');\nhideProperty(proto, 'reportAccessPath');\nhideProperty(proto, 'cleanup');\nhideProperty(proto, 'unlink');\nhideProperty(proto, 'relink');\nhideProperty(proto, 'relinkBase');\nhideProperty(proto, 'relinkProp');\nhideProperty(proto, 'setRemarkable');\nhideProperty(proto, 'getRemarkableFullPaths');\nhideProperty(proto, 'rebase');\nhideProperty(proto, 'assertScope');\n\nexport default internalFunctions;\n","import internalFunctions from './internalFunctions';\nimport { inherit, Type, createHiddenProperty } from './commons';\nimport {\n  ES5TrackerConstructorProps,\n  ES5TrackerConstructor,\n  IES5Tracker,\n} from './types';\n\nlet count = 0;\n\nconst ES5Tracker = (function(\n  this: ES5TrackerConstructor,\n  {\n    accessPath,\n    parentProxy,\n    rootPath,\n    base,\n    trackerNode,\n    useRevoke,\n    useScope,\n  }: ES5TrackerConstructorProps\n) {\n  createHiddenProperty(this, 'id', `ES5Tracker_${count++}`) // eslint-disable-line\n\n  createHiddenProperty(this, 'trackerNode', trackerNode);\n  createHiddenProperty(this, 'accessPath', accessPath);\n  createHiddenProperty(this, 'rootPath', rootPath);\n  createHiddenProperty(\n    this,\n    'type',\n    Array.isArray(base) ? Type.Array : Type.Object\n  );\n  createHiddenProperty(this, 'base', base);\n\n  createHiddenProperty(this, 'parentProxy', parentProxy);\n  createHiddenProperty(this, 'childProxies', {});\n\n  createHiddenProperty(this, 'isPeeking', false);\n  createHiddenProperty(this, 'propProperties', []);\n  createHiddenProperty(this, 'paths', []);\n\n  createHiddenProperty(this, 'useRevoke', useRevoke);\n  createHiddenProperty(this, 'useScope', useScope);\n\n  createHiddenProperty(this, 'isRevoked', false);\n  createHiddenProperty(this, 'assertRevoke', function(this: IES5Tracker) {\n    const useRevoke = this.getProp('useRevoke');\n    if (!useRevoke) return;\n    const isRevoked = this.getProp('isRevoked');\n    if (isRevoked) {\n      throw new Error(\n        'Cannot use a proxy that has been revoked. Did you pass an object ' +\n          'to an async process? '\n      );\n    }\n  });\n} as any) as ES5TrackerConstructor;\n\ninherit(ES5Tracker, internalFunctions);\n\nexport default ES5Tracker;\n","import {\n  isObject,\n  TRACKER,\n  each,\n  shallowCopy,\n  isTrackable,\n  createHiddenProperty,\n} from './commons';\nimport ES5Tracker from './ES5Tracker';\nimport context from './context';\nimport {\n  IES5Tracker,\n  ES5TrackerInterface,\n  ES5TrackerConfig,\n  TrackerNode,\n  PropProperty,\n} from './types';\n\nconst peek = (proxy: IES5Tracker, accessPath: Array<string>) => { // eslint-disable-line\n  return accessPath.reduce((proxy, cur) => {\n    proxy.setProp('isPeeking', true);\n    const nextProxy = proxy[cur];\n    proxy.setProp('isPeeking', false);\n    return nextProxy;\n  }, proxy);\n};\n\nfunction createES5Tracker(\n  target: any,\n  config: ES5TrackerConfig,\n  trackerNode: TrackerNode\n): IES5Tracker {\n  const { accessPath = [], parentProxy, useRevoke, useScope, rootPath = [] } =\n    config || {};\n\n  if (!isObject(target)) {\n    throw new TypeError(\n      'Cannot create proxy with a non-object as target or handler'\n    );\n  }\n\n  const proxy: IES5Tracker = shallowCopy(target);\n\n  function proxyProperty(\n    proxy: IES5Tracker,\n    prop: PropertyKey,\n    enumerable: boolean\n  ) {\n    const desc = {\n      enumerable,\n      configurable: false,\n      get(this: IES5Tracker) {\n        this.runFn('assertRevoke');\n        this.runFn('assertScope');\n        const base = this.getProp('base');\n        const accessPath = this.getProp('accessPath');\n        const childProxies = this.getProp('childProxies');\n        const isPeeking = this.getProp('isPeeking');\n        const value = base[prop];\n        // For es5, the prop in array index getter is integer; when use proxy,\n        // `prop` will be string.\n        const nextAccessPath = accessPath.concat(`${prop as string}`);\n\n        if (!isPeeking) {\n          // for relink return parent prop...\n          if (\n            context.trackerNode &&\n            trackerNode.id !== context.trackerNode.id\n          ) {\n            const contextProxy = context.trackerNode.proxy;\n            const propProperties: Array<PropProperty> = contextProxy?.getProp(\n              'propProperties'\n            );\n            propProperties.push({\n              path: nextAccessPath,\n              source: trackerNode.proxy,\n            });\n            this.setProp('propProperties', propProperties);\n            if (trackerNode.proxy)\n              return peek(trackerNode.proxy as IES5Tracker, nextAccessPath);\n          }\n          this.runFn('reportAccessPath', nextAccessPath);\n        }\n\n        if (!isTrackable(value)) return value;\n        const childProxy = childProxies[prop];\n        // for rebase value, if base value change, the childProxy should\n        // be replaced\n        if (childProxy && childProxy.base === value) {\n          return childProxy;\n        }\n        return (childProxies[prop] = createES5Tracker(\n          value,\n          {\n            accessPath: nextAccessPath,\n            parentProxy: proxy,\n            rootPath,\n            useRevoke,\n            useScope,\n          },\n          trackerNode\n        ));\n      },\n    };\n\n    Object.defineProperty(proxy, prop, desc);\n  }\n\n  each(target as Array<any>, (prop: PropertyKey) => {\n    const desc = Object.getOwnPropertyDescriptor(target, prop);\n    const enumerable = desc?.enumerable || false;\n    proxyProperty(proxy, prop, enumerable);\n  });\n\n  if (Array.isArray(target)) {\n    const descriptors = Object.getPrototypeOf([]);\n    const keys = Object.getOwnPropertyNames(descriptors);\n\n    const handler = (\n      func: Function,\n      functionContext: IES5Tracker,\n      lengthGetter = true\n    ) =>\n      function(this: IES5Tracker) {\n      const args = Array.prototype.slice.call(arguments) // eslint-disable-line\n        this.runFn('assertRevoke');\n        if (lengthGetter) {\n          const accessPath = this.getProp('accessPath');\n          const isPeeking = this.getProp('isPeeking');\n          const nextAccessPath = accessPath.concat('length');\n\n          if (!isPeeking) {\n            if (\n              context.trackerNode &&\n              trackerNode.id !== context.trackerNode.id\n            ) {\n              const contextProxy = context.trackerNode.proxy;\n              const propProperties = contextProxy?.getProp('propProperties');\n              propProperties.push({\n                path: nextAccessPath,\n                source: trackerNode.proxy,\n              });\n\n              this.setProp('propProperties', propProperties);\n            }\n            this.runFn('reportAccessPath', nextAccessPath);\n          }\n        }\n\n        return func.apply(functionContext, args);\n      };\n\n    keys.forEach(key => {\n      const func = descriptors[key];\n      if (typeof func === 'function') {\n        const notRemarkLengthPropKeys = ['concat', 'copyWith'];\n        const remarkLengthPropKeys = [\n          'concat',\n          'copyWith',\n          'fill',\n          'find',\n          'findIndex',\n          'lastIndexOf',\n          'pop',\n          'push',\n          'reverse',\n          'shift',\n          'unshift',\n          'slice',\n          'sort',\n          'splice',\n          'includes',\n          'indexOf',\n          'join',\n          'keys',\n          'entries',\n          'forEach',\n          'filter',\n          'flat',\n          'flatMap',\n          'map',\n          'every',\n          'some',\n          'reduce',\n          'reduceRight',\n        ];\n        if (notRemarkLengthPropKeys.indexOf(key) !== -1) {\n          createHiddenProperty(proxy, key, handler(func, proxy, false));\n        } else if (remarkLengthPropKeys.indexOf(key) !== -1) {\n          createHiddenProperty(proxy, key, handler(func, proxy));\n        }\n      }\n    });\n  }\n\n  const tracker = new ES5Tracker({\n    base: target,\n    parentProxy,\n    accessPath,\n    rootPath,\n    trackerNode,\n    useRevoke,\n    useScope,\n  });\n\n  createHiddenProperty(proxy, 'getProps', function(this: IES5Tracker) {\n    const args: Array<keyof ES5TrackerInterface> = Array.prototype.slice.call(\n      arguments\n    );\n    return args.map(prop => this[TRACKER][prop]);\n  });\n  createHiddenProperty(proxy, 'getProp', function(this: IES5Tracker) {\n    const args: Array<keyof ES5TrackerInterface> = Array.prototype.slice.call(\n      arguments\n    );\n    return this[TRACKER][args[0]];\n  });\n  createHiddenProperty(proxy, 'setProp', function(this: IES5Tracker) {\n    const args = Array.prototype.slice.call(arguments);\n    const prop = args[0];\n    const value = args[1];\n    // @ts-ignore\n    return (this[TRACKER][prop] = value);\n  });\n  createHiddenProperty(proxy, 'runFn', function(this: IES5Tracker) {\n    const args = Array.prototype.slice.call(arguments);\n    const fn = this[TRACKER][args[0] as keyof ES5TrackerInterface];\n    const rest = args.slice(1);\n    if (typeof fn === 'function') return (fn as Function).apply(this, rest);\n  });\n  createHiddenProperty(proxy, 'unlink', function(this: IES5Tracker) {\n    return this.runFn('unlink');\n  });\n  createHiddenProperty(proxy, 'createChild', function(this: IES5Tracker) {\n    const args = Array.prototype.slice.call(arguments);\n    const target = args[0] || {};\n    const config = args[1] || {};\n    return createES5Tracker(\n      target,\n      {\n        useRevoke,\n        useScope,\n        rootPath,\n        ...config,\n      },\n      trackerNode\n    );\n  });\n  createHiddenProperty(proxy, 'revoke', function(this: IES5Tracker) {\n    const useRevoke = this.getProp('useRevoke');\n    if (useRevoke) this.setProp('isRevoked', true);\n  });\n\n  createHiddenProperty(proxy, TRACKER, tracker);\n\n  return proxy as IES5Tracker;\n}\n\nexport default createES5Tracker;\n","export enum Type {\n  Object = 'object',\n  Array = 'array',\n}\n","import internalFunctions from './internalFunctions';\nimport { inherit, createHiddenProperty } from './commons';\nimport {\n  ProxyTrackerConstructor,\n  ProxyTrackerConstructorProps,\n  Type,\n} from './types';\n\nlet count = 0;\n\n// 'this' implicitly has type 'any'\n// https://stackoverflow.com/questions/52431074/how-to-solve-this-implicitly-has-type-any-when-typescript-checking-classic\nconst ProxyTracker = (function(\n  this: ProxyTrackerConstructor,\n  {\n    accessPath,\n    parentProxy,\n    rootPath,\n    base,\n    trackerNode,\n    useRevoke,\n    useScope,\n  }: ProxyTrackerConstructorProps\n) {\n  createHiddenProperty(this, 'id', `ProxyTracker_${count++}`) // eslint-disable-line\n\n  createHiddenProperty(this, 'trackerNode', trackerNode);\n  createHiddenProperty(this, 'accessPath', accessPath);\n  createHiddenProperty(this, 'rootPath', rootPath);\n  createHiddenProperty(\n    this,\n    'type',\n    Array.isArray(base) ? Type.Array : Type.Object\n  );\n  createHiddenProperty(this, 'base', base);\n\n  createHiddenProperty(this, 'parentProxy', parentProxy);\n  createHiddenProperty(this, 'childProxies', {} as any);\n\n  createHiddenProperty(this, 'isPeeking', false);\n  createHiddenProperty(this, 'propProperties', [] as any);\n  createHiddenProperty(this, 'paths', [] as any);\n\n  createHiddenProperty(this, 'useRevoke', useRevoke);\n  createHiddenProperty(this, 'useScope', useScope);\n  // function constructor https://stackoverflow.com/a/43624326/2006805\n} as any) as ProxyTrackerConstructor;\n\ninherit(ProxyTracker, internalFunctions);\n\nexport default ProxyTracker;\n","import {\n  isObject,\n  TRACKER,\n  shallowCopy,\n  isTrackable,\n  hasOwnProperty,\n  createHiddenProperty,\n} from './commons';\nimport ProxyTracker from './proxyTracker';\nimport context from './context';\nimport {\n  IProxyTracker,\n  ProxyTrackerInterface,\n  TrackerNode,\n  ProxyTrackerConfig,\n  ProxyTrackerFunctions,\n  PropProperty,\n} from './types';\n\nconst peek = (proxy: IProxyTracker, accessPath: Array<string>) => { // eslint-disable-line\n  return accessPath.reduce((proxy, cur) => {\n    proxy.setProp('isPeeking', true);\n    const nextProxy = proxy[cur] as any;\n    proxy.setProp('isPeeking', false);\n    return nextProxy;\n  }, proxy);\n};\n\nfunction createTracker(\n  target: any,\n  config: ProxyTrackerConfig,\n  trackerNode: TrackerNode\n): IProxyTracker {\n  const { accessPath = [], parentProxy, useRevoke, useScope, rootPath = [] } =\n    config || {};\n\n  if (!isObject(target)) {\n    throw new TypeError(\n      'Cannot create proxy with a non-object as target or handler'\n    );\n  }\n\n  const copy = shallowCopy(target);\n\n  const internalProps = [\n    TRACKER,\n    'revoke',\n    'runFn',\n    'unlink',\n    'getProp',\n    'setProp',\n    'getProps',\n    'createChild',\n  ];\n\n  // can not use this in handler, should be `target`\n  const handler = {\n    get: (target: IProxyTracker, prop: PropertyKey, receiver: any) => {\n      target.runFn('assertScope');\n      if (prop === TRACKER) return Reflect.get(target, prop, receiver);\n      // assertScope(trackerNode, context.trackerNode)\n      const base = target.getProp('base');\n\n      // refer to immer...\n      // if (Array.isArray(tracker)) target = tracker[0]\n      const isInternalPropAccessed = internalProps.indexOf(prop as any) !== -1;\n      if (isInternalPropAccessed || !hasOwnProperty(base, prop)) {\n        return Reflect.get(target, prop, receiver);\n      }\n      const accessPath = target.getProp('accessPath');\n      const nextAccessPath = accessPath.concat(prop);\n      const isPeeking = target.getProp('isPeeking');\n\n      if (!isPeeking) {\n        // for relink return parent prop...\n        if (context.trackerNode && trackerNode.id !== context.trackerNode.id) {\n          const contextProxy = context.trackerNode.proxy;\n          const propProperties: Array<PropProperty> = contextProxy?.getProp(\n            'propProperties'\n          );\n          propProperties.push({\n            path: nextAccessPath,\n            source: trackerNode.proxy,\n          });\n          target.setProp('propProperties', propProperties);\n          if (trackerNode.proxy)\n            return peek(trackerNode.proxy as IProxyTracker, nextAccessPath);\n        }\n        target.runFn('reportAccessPath', nextAccessPath);\n      }\n      const childProxies = target.getProp('childProxies');\n      const value = base[prop];\n\n      if (!isTrackable(value)) return value;\n      const childProxy = childProxies[prop];\n\n      // for rebase value, if base value change, the childProxy should\n      // be replaced\n      if (childProxy && childProxy.base === value) {\n        return childProxy;\n      }\n      return (childProxies[prop] = createTracker(\n        value,\n        {\n          accessPath: nextAccessPath,\n          parentProxy: target,\n          rootPath,\n          useRevoke,\n          useScope,\n        },\n        trackerNode\n      ));\n    },\n  };\n\n  const tracker = new ProxyTracker({\n    base: target,\n    parentProxy,\n    accessPath,\n    rootPath,\n    trackerNode,\n    useRevoke,\n    useScope,\n  });\n\n  const { proxy, revoke } = Proxy.revocable<IProxyTracker>(copy, handler);\n\n  createHiddenProperty(proxy, 'getProps', function(this: IProxyTracker) {\n    const args: Array<keyof ProxyTrackerInterface> = Array.prototype.slice.call(\n      arguments\n    );\n    return args.map(prop => this[TRACKER][prop]);\n  });\n  createHiddenProperty(proxy, 'getProp', function(this: IProxyTracker) {\n    const args: Array<keyof ProxyTrackerInterface> = Array.prototype.slice.call(\n      arguments\n    );\n    return this[TRACKER][args[0]];\n  });\n  createHiddenProperty(proxy, 'setProp', function(this: IProxyTracker) {\n    const args = Array.prototype.slice.call(arguments) // eslint-disable-line\n    const prop = args[0];\n    const value = args[1];\n    // this[TRACKER][prop as keyof ProxyTrackerInterface] = value\n    // @ts-ignore\n    return (this[TRACKER][prop] = value);\n  });\n  createHiddenProperty(proxy, 'runFn', function(this: IProxyTracker): any {\n    const args = Array.prototype.slice.call(arguments) // eslint-disable-line\n    const fn = this[TRACKER][args[0] as keyof ProxyTrackerFunctions];\n    const rest = args.slice(1);\n    if (typeof fn === 'function') return (fn as Function).apply(this, rest);\n  });\n  createHiddenProperty(proxy, 'unlink', function(this: IProxyTracker) {\n    return this.runFn('unlink');\n  });\n  createHiddenProperty(proxy, 'createChild', function(this: IProxyTracker) {\n    const args = Array.prototype.slice.call(arguments) // eslint-disable-line\n    const target = args[0] || {};\n    const config = args[1] || {};\n    return createTracker(\n      target,\n      {\n        useRevoke,\n        useScope,\n        rootPath,\n        ...config,\n      },\n      trackerNode\n    );\n  });\n  createHiddenProperty(proxy, 'revoke', function(this: IProxyTracker) {\n    const useRevoke = this.getProp('useRevoke');\n    if (useRevoke) revoke();\n  });\n\n  createHiddenProperty(proxy, TRACKER, tracker);\n\n  return proxy as IProxyTracker;\n}\n\nexport default createTracker;\n","import context from './context';\nimport createES5Tracker from './es5';\nimport createTracker from './proxy';\n\nimport {\n  HydrateConfig,\n  IProxyTracker,\n  IES5Tracker,\n  TrackerNodeConstructorProps,\n} from './types';\n\nlet count = 0;\n\nclass TrackerNode {\n  public base: object;\n  public useRevoke: boolean;\n  public useScope: boolean;\n  public useProxy: boolean;\n  public rootPath: Array<string>;\n  public children: Array<any>;\n  public parent: null | TrackerNode;\n  public prevSibling: null | TrackerNode;\n  public nextSibling: null | TrackerNode;\n  public proxy: null | IProxyTracker | IES5Tracker;\n  public id: string;\n  public isRevoked: boolean;\n  public inScope: boolean;\n\n  constructor({\n    parent,\n    isSibling,\n    base,\n    useRevoke,\n    useScope,\n    useProxy,\n    rootPath,\n  }: TrackerNodeConstructorProps) {\n    this.base = base;\n    this.useRevoke = useRevoke;\n    this.useScope = useScope;\n    this.useProxy = useProxy;\n\n    this.rootPath = rootPath || [];\n\n    this.children = [];\n    this.parent = parent;\n    this.prevSibling = null;\n    this.nextSibling = null;\n    this.proxy = null;\n    this.id = `__TrackerNode_${count++}__` // eslint-disable-line\n    this.isRevoked = false;\n\n    this.inScope = false;\n\n    this.updateParent();\n    if (isSibling) {\n      this.initPrevSibling();\n    }\n\n    if (this.base) {\n      this.enterTrackerScope();\n    }\n  }\n\n  updateParent() {\n    if (this.parent) {\n      this.parent.children.push(this);\n    }\n  }\n\n  enterTrackerScope() {\n    this.enterContext();\n    const fn = this.useProxy ? createTracker : createES5Tracker;\n    this.proxy = fn(\n      this.base,\n      {\n        useRevoke: this.useRevoke,\n        useScope: this.useScope,\n        rootPath: this.rootPath,\n      },\n      this\n    );\n  }\n\n  enterContext() {\n    context.trackerNode = this;\n    this.inScope = true;\n  }\n\n  leaveContext() {\n    if (this.inScope) {\n      this.inScope = false;\n      context.trackerNode = null;\n    }\n\n    if (this.parent && this.parent.inScope) {\n      context.trackerNode = this.parent;\n    }\n  }\n\n  initPrevSibling() {\n    if (this.parent) {\n      const childNodes = this.parent.children;\n      const lastChild = childNodes[childNodes.length - 1];\n      this.prevSibling = lastChild;\n      if (lastChild) {\n        lastChild.nextSibling = this;\n      }\n    }\n  }\n\n  destroy() {\n    if (this.parent) {\n      const index = this.parent.children.indexOf(this);\n      this.parent.children.splice(index, 1);\n    }\n    const prev = this.prevSibling;\n    const next = this.nextSibling;\n\n    if (prev) {\n      if (next) prev.nextSibling = next;\n      else prev.nextSibling = null;\n    }\n\n    if (next) {\n      if (prev) next.prevSibling = prev;\n      else next.prevSibling = null;\n    }\n  }\n\n  contains(childNode: TrackerNode): boolean {\n    if (childNode === this) return true;\n    if (!childNode) return false;\n    const parent = childNode.parent;\n    if (!parent) return false;\n    if (parent === this) return true;\n    return this.contains(parent);\n  }\n\n  revokeLastChild() {\n    if (this.children.length) {\n      this.children[this.children.length - 1].revoke();\n    }\n  }\n\n  /**\n   *\n   * @param {null | TrackerNode} parent, null value means revoke until to top most.\n   */\n  revokeUntil(parent?: TrackerNode): boolean {\n    if (parent === this) return true;\n\n    if (parent) {\n      if (parent.isRevoked)\n        throw new Error('Assign a `revoked` parent is forbidden');\n    }\n\n    if (this.parent) {\n      // if (!parent) throw new Error('parent should exist')\n\n      // the top most node, still can not find `parent` node\n      // if (!this.parent) throw new Error('`parent` is not a valid `TrackerNode`')\n      if (this.parent) {\n        return this.parent.revokeUntil(parent);\n      }\n    }\n\n    return this.revokeSelf();\n  }\n\n  revokeSelf(): boolean {\n    if (this.children.length) {\n      this.children.forEach(child => {\n        if (!child.isRevoked) child.revokeSelf();\n      });\n    }\n    if (!this.isRevoked) {\n      this.proxy?.revoke();\n      this.isRevoked = true;\n    }\n    return true;\n  }\n\n  /**\n   * return context handler to parent node.\n   */\n  revoke() {\n    if (this.parent) {\n      this.proxy?.revoke();\n      context.trackerNode = this.parent;\n    }\n  }\n\n  hydrate(base: object, config: HydrateConfig = {}) {\n    this.base = base || this.base;\n    const keys = Object.keys(config || ({} as HydrateConfig));\n    // Object.keys always return 'string[]', So it need to\n    // convert explicitly\n    // https://stackoverflow.com/a/52856805/2006805\n    (keys as Array<keyof HydrateConfig>).forEach(key => {\n      // @ts-ignore\n      this[key] = config[key];\n    });\n    this.enterTrackerScope();\n  }\n}\n\nexport default TrackerNode;\n","import { canIUseProxy } from './commons';\nimport context from './context';\nimport TrackerNode from './TrackerNode';\nimport invariant from 'invariant';\n\n/**\n * resolve `reactivePaths`, and wrap `autoRunFunc`\n * @param {*} param0\n */\nconst Tracker = ({\n  base,\n  parent,\n  useProxy = true,\n  useRevoke = false,\n  useScope = true,\n  rootPath = [],\n}: {\n  base: object;\n  parent: null | TrackerNode;\n  useProxy: boolean;\n  useRevoke: boolean;\n  useScope: boolean;\n  rootPath: Array<string>;\n}) => {\n  const assertAccessibility = (useScope: boolean, useRevoke: boolean) => {\n    invariant(\n      useRevoke !== useScope,\n      '`useRevoke` or `useScope` should not be equal; and one must be true' +\n        'If you do not have any idea, please leave to use default value.'\n    );\n  };\n\n  assertAccessibility(useScope, useRevoke);\n\n  const verifiedUseProxy = canIUseProxy() && useProxy;\n  const parentTrackerNode =\n    typeof parent !== 'undefined' ? parent : context.trackerNode;\n  let isSibling = false;\n\n  // re-create a top most node\n  if (!parentTrackerNode) {\n    // start another top level branch...like\n    // { a: { b: 1 }} => { a: { b: 1 }, c: {d: 2 }}\n    if (context.trackerNode && useRevoke) {\n      context.trackerNode.revokeUntil();\n    }\n  } else {\n    if (parentTrackerNode === context.trackerNode) {\n      // Add a child, for sibling, intersection access is forbidden.\n      if (useRevoke) {\n        parentTrackerNode.revokeLastChild();\n      }\n    } else if (useRevoke && context.trackerNode) {\n      // Add a parentTrackerNode's sibling, so `revokeUntil` is required.\n      context.trackerNode.revokeUntil(parentTrackerNode);\n    }\n\n    if (\n      context.trackerNode &&\n      parentTrackerNode === context.trackerNode.parent\n    ) {\n      isSibling = true;\n    }\n  }\n\n  return new TrackerNode({\n    parent: parentTrackerNode,\n    isSibling,\n    base,\n    useRevoke,\n    useScope,\n    useProxy: verifiedUseProxy,\n    rootPath,\n  });\n};\n\nexport default Tracker;\n","import { IPatcher } from './types';\n\nclass Patcher implements IPatcher {\n  public autoRunFn: Function;\n  public paths: Array<Array<string>>;\n  public removers: Array<Function>;\n  public dirty: boolean;\n  public id: string;\n  public displayName: string;\n  public parent: null | Patcher;\n  public children: Array<any>;\n\n  constructor({\n    paths,\n    autoRunFn,\n    key,\n    parent,\n    displayName,\n  }: {\n    paths: Array<Array<string>>;\n    autoRunFn: Function;\n    key: string;\n    parent: null | Patcher;\n    displayName: string;\n  }) {\n    this.autoRunFn = autoRunFn;\n    this.paths = paths;\n\n    this.removers = [];\n    this.dirty = false;\n    this.id = key;\n    this.displayName = displayName;\n    this.parent = parent;\n    this.children = [];\n\n    if (this.parent) {\n      this.parent.children.push(this);\n    }\n  }\n\n  destroyPatcher() {\n    this.teardown();\n    if (this.children.length) {\n      this.children.forEach(child => child.destroyPatcher());\n    }\n\n    if (this.parent) {\n      this.parent.removeChild(this);\n    }\n    this.parent = null;\n  }\n\n  appendTo(parent: null | Patcher) {\n    if (this.parent) {\n      this.parent.removeChild(this);\n    }\n\n    if (parent) {\n      this.parent = parent;\n\n      if (parent.children.indexOf(this) === -1) {\n        parent.children.push(this);\n      }\n    }\n  }\n\n  belongs(parent: null | Patcher): boolean {\n    if (!parent) return false;\n\n    if (this.parent) {\n      if (this.parent === parent) {\n        return true;\n      }\n      return this.parent.belongs(parent);\n    }\n\n    return false;\n  }\n\n  removeChild(child: Patcher) {\n    const index = this.children.indexOf(child);\n    if (index !== -1) this.children.splice(index, 1);\n  }\n\n  update({ paths }: { paths: Array<Array<string>> }) {\n    this.paths = paths;\n    this.dirty = false;\n    this.teardown();\n  }\n\n  addRemover(remover: Function) {\n    this.removers.push(remover);\n  }\n\n  // 将patcher从PathNode上删除\n  teardown() {\n    this.removers.forEach(remover => remover());\n    this.removers = [];\n  }\n\n  markDirty() {\n    this.teardown();\n  }\n\n  markDirtyAll() {\n    this.teardown();\n\n    // If parent is dirty, then its children should be all dirty...\n    if (this.children.length) {\n      this.children.forEach(child => child.markDirtyAll());\n    }\n  }\n\n  triggerAutoRun() {\n    if (typeof this.autoRunFn === 'function') this.autoRunFn();\n  }\n}\n\nexport default Patcher;\n","import React, {\n  useContext,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n  FC,\n} from 'react';\nimport context from './context';\nimport Tracker from './tracker';\nimport { generatePatcherKey } from './utils/key';\nimport Patcher from './Patcher';\nimport infoLog from './utils/infoLog';\nimport { TrackerNode, PropProperty } from './tracker/types';\n\nlet count = 0;\n\nconst Helper = ({ addListener }: { addListener: Function }) => {\n  addListener();\n  return null;\n};\n\nconst DEBUG = false;\n\nconst unMountMap: {\n  [key: string]: undefined | Patcher;\n} = {};\nconst reRenderMap: {\n  [key: string]: undefined | Patcher;\n} = {};\n\nconst diff = (\n  componentName: string,\n  patcher: undefined | Patcher,\n  proxy: undefined | TrackerNode\n) => {\n  const key1 = Object.keys(unMountMap);\n  if (key1.indexOf(componentName) !== -1) {\n    infoLog('invalid re-render', componentName, patcher, proxy);\n  }\n};\n\nexport default (WrappedComponent: FC<any>) => {\n  function NextComponent(props: any) {\n    const shadowState = useRef(0);\n    // @ts-ignore\n    const [_, setState] = useState(0); // eslint-disable-line\n    const storeName = useRef<string>();\n    const isHydrated = useRef(false);\n    const isInit = useRef(true);\n    const patcherUpdated = useRef(0);\n\n    const {\n      application,\n      useProxy,\n      namespace,\n      patcher: parentPatcher,\n      trackerNode: parentTrackerNode,\n      useRelinkMode,\n      ...rest\n    } = useContext(context);\n\n    const incrementCount = useRef(count++)  // eslint-disable-line\n    const componentName = `${NextComponent.displayName}-${incrementCount.current}`;\n    const patcher = useRef<undefined | Patcher>();\n    const trackerNode = useRef<undefined | TrackerNode>();\n\n    shadowState.current += 1;\n\n    const autoRunFn = () => {\n      setState(state => state + 1);\n      reRenderMap[componentName] = patcher.current;\n      diff(componentName, patcher.current, trackerNode.current);\n    };\n\n    useEffect(() => {\n      if (!DEBUG) return;\n      if (isInit.current) {\n        infoLog('[Observe]', `${componentName} is init`);\n        isInit.current = false;\n      } else {\n        infoLog('[Observe]', `${componentName} is re-rendered`);\n      }\n    });\n\n    if (!patcher.current) {\n      patcher.current = new Patcher({\n        paths: [],\n        autoRunFn,\n        parent: parentPatcher,\n        key: generatePatcherKey({\n          namespace: namespace as string,\n          componentName,\n        }),\n        displayName: NextComponent.displayName,\n      });\n    }\n\n    if (!trackerNode.current) {\n      // `base` should has a default value value `{}`, or it will cause error.\n      // Detail refer to https://github.com/ryuever/relinx/issues/6\n      trackerNode.current = Tracker({\n        base: {},\n        useProxy,\n        useRevoke: false,\n        useScope: true,\n        parent: parentTrackerNode,\n        rootPath: [],\n      });\n    }\n\n    if (trackerNode.current) {\n      trackerNode.current.enterContext();\n    }\n\n    // destroy `patcher` when component un-mount.\n    useEffect(\n      () => () => {\n        if (patcher.current) patcher.current.destroyPatcher();\n        unMountMap[componentName] = patcher.current;\n      },\n      [] // eslint-disable-line\n    );\n\n    const getData = useCallback(\n      () => ({\n        trackerNode: trackerNode.current,\n      }),\n      []\n    );\n\n    // onUpdate, `relink` relative paths value....\n    if (trackerNode.current.proxy) {\n      const proxy = trackerNode.current.proxy;\n      // 为什么如果进行remove的话，`propProperties`已经将旧key删除了呢。。。\n      const propProperties: Array<PropProperty> = proxy.getProp(\n        'propProperties'\n      );\n\n      propProperties.forEach(prop => {\n        try {\n          const { source } = prop;\n          const rootPath = source?.getProp('rootPath');\n          const storeName = rootPath[0];\n          const currentBase = application?.getStoreData(storeName);\n          source?.runFn('relinkBase', currentBase);\n        } catch (err) {\n          infoLog('[observe rebase propProperties]', err);\n        }\n      });\n\n      if (useRelinkMode) {\n        if (storeName.current) {\n          const base = application?.getStoreData(storeName.current);\n          proxy.runFn('rebase', base);\n        }\n      }\n\n      trackerNode.current.proxy.runFn('cleanup');\n    }\n\n    // only run one time\n    const attachStoreName = useCallback((name: string) => {\n      if (useRelinkMode) {\n        if (name && !isHydrated.current) {\n          storeName.current = name;\n          const initialState = application?.getStoreData(storeName.current);\n          trackerNode.current?.hydrate(initialState, {\n            rootPath: [storeName.current],\n          });\n          isHydrated.current = true;\n        }\n      } else {\n        storeName.current = name;\n        const initialState = application?.getStoreData(storeName.current);\n        trackerNode.current?.hydrate(initialState, {\n          rootPath: [storeName.current],\n        });\n        isHydrated.current = true;\n      }\n    }, []); // eslint-disable-line\n\n    const addListener = useCallback(() => {\n      patcher.current?.appendTo(parentPatcher); // maybe not needs\n      if (!trackerNode.current?.proxy) return;\n\n      const paths = trackerNode.current.proxy.runFn('getRemarkableFullPaths');\n      patcher.current?.update({ paths });\n      if (patcher.current) application?.addPatcher(patcher.current);\n      patcherUpdated.current += 1;\n      trackerNode.current.leaveContext();\n    }, []); // eslint-disable-line\n\n    const contextValue = {\n      ...rest,\n      getData,\n      application,\n      useProxy,\n      namespace,\n      useRelinkMode,\n      patcher: patcher.current,\n      trackerNode: trackerNode.current,\n      attachStoreName,\n    };\n\n    return (\n      <context.Provider value={contextValue}>\n        <React.Fragment>\n          <WrappedComponent {...props} />\n          <Helper addListener={addListener} />\n        </React.Fragment>\n      </context.Provider>\n    );\n  }\n\n  NextComponent.displayName =\n    WrappedComponent.displayName ||\n    WrappedComponent.name ||\n    'ObservedComponent';\n\n  return NextComponent;\n  // return React.memo(props => <NextComponent {...props} />, () => true)\n};\n"],"names":["calculateChangeBits","noop","defaultValue","computation","dispatch","attachStoreName","useProxy","namespace","patcher","trackerNode","useRelinkMode","application","createContext","infoLog","args","console","log","PathNode","constructor","prop","parent","children","patchers","addPathNode","path","len","length","reduce","node","cur","index","childNode","push","addRemover","indexOf","splice","destroyPathNode","forEach","destroyPatcher","childKeys","Object","keys","key","pathNode","err","is","x","y","toString","Function","call","bind","prototype","isObject","obj","isArray","isMutable","isTypeEqual","o1","o2","diffArraySimple","a","b","parts","i","Application","base","strictMode","pendingPatchers","update","values","value","treeShake","updateBase","finalPatchers","current","l","found","belongs","triggerAutoRun","storeKey","changedValue","origin","branch","baseValue","rootBaseValue","nextValue","toDestroy","compare","collections","operation","markDirty","caredKeys","keysToCompare","keysToDestroy","currentOperation","Array","baseLength","nextLength","filter","parseInt","concat","isDelete","nextKeys","prevKeys","removed","childBranch","displayName","joinedPath","join","warn","childBaseValue","undefined","childNextValue","fn","addPatcher","paths","fullPath","getStoreData","storeName","storeValue","seenKeys","MULTIPLIER","Math","pow","generateNamespaceKey","hasOwnProperty","isNaN","floor","random","patcherSeenKeys","generatePatcherKey","componentName","count","next","generateRandomGlobalActionKey","Provider","store","namespaceRef","useRef","getState","bindApplication","contextValue","React","context","compose","funcs","arg","applyMiddleware","middleware","nextMiddleware","createStore","config","initialState","api","actions","rest","chain","map","decorateDispatch","Store","configs","models","initialValue","_state","_reducers","_effects","_pendingActions","injectModel","_application","subscriptions","_count","getReducers","getEffects","setValue","nextActions","changedValues","changedValueGroup","action","type","payload","actionType","split","usedReducer","currentState","toObject","acc","oldState","newState","subscription","diff","chainedMiddleware","generateSubscriptionKey","subscribe","model","state","reducers","effects","nextPendingActions","reducer","effect","nextState","enhancer","getData","useContext","invariant","proxy","GlobalHelper","addAction","actionKey","remover","findIndex","targetNamespace","globalHelper","nextDispatch","thunkActions","nextArgs","slice","nextAction","v","reducerActions","effectActions","currentEffects","info","handler","padding","paddingCount","formatTime","d","date","Date","hh","getHours","mm","getMinutes","ss","getSeconds","ms","getMilliseconds","colorLine","apply","colorGroupEnd","groupEnd","colorGroupCollapsed","groupCollapsed","colorLog","group","text","t","styles","s","subText","subStyle","renderTitle","props","initialActions","startTime","endTime","title","actionColor","startsWith","renderSubAction","style","renderState","isNextState","renderPrevState","paint","tree","actionKeys","effectKeys","paintActions","prevState","now","JSON","parse","stringify","print","ownKeys","o","Reflect","getOwnPropertySymbols","getOwnPropertyNames","hasSymbol","Symbol","TRACKER","canIUseProxy","Proxy","isTrackable","each","iter","entry","Type","shallowCopy","create","getPrototypeOf","inherit","subClass","superClass","createHiddenProperty","target","defineProperty","enumerable","writable","hideProperty","configurable","joinPath","generateRemarkablePaths","copy","accessMap","remarkablePaths","pathLength","isConsecutive","pop","p","str","find","peek","accessPath","setProp","nextProxy","internalFunctions","proto","assertLink","fnName","getProp","reportAccessPath","parentProxy","runFn","cleanup","unlink","relink","last","nextBaseValue","relinkProp","newValue","childProxies","createChild","relinkBase","rebase","setRemarkable","getRemarkableFullPaths","propProperties","rootPath","internalPaths","external","source","sourceRootPath","externalPaths","assertScope","useScope","contains","Error","id","ES5Tracker","useRevoke","isRevoked","createES5Tracker","TypeError","proxyProperty","desc","get","isPeeking","nextAccessPath","contextProxy","childProxy","getOwnPropertyDescriptor","descriptors","func","functionContext","lengthGetter","arguments","notRemarkLengthPropKeys","remarkLengthPropKeys","tracker","ProxyTracker","createTracker","internalProps","receiver","isInternalPropAccessed","revoke","revocable","TrackerNode","isSibling","prevSibling","nextSibling","inScope","updateParent","initPrevSibling","enterTrackerScope","enterContext","leaveContext","childNodes","lastChild","destroy","prev","revokeLastChild","revokeUntil","revokeSelf","child","hydrate","Tracker","assertAccessibility","verifiedUseProxy","parentTrackerNode","Patcher","autoRunFn","removers","dirty","teardown","removeChild","appendTo","markDirtyAll","Helper","addListener","unMountMap","key1","WrappedComponent","NextComponent","shadowState","_","setState","useState","isHydrated","isInit","patcherUpdated","parentPatcher","incrementCount","reRenderMap","useEffect","useCallback","currentBase","name","Fragment"],"mappings":"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"}